import{__spreadArrays}from"tslib";import{ObservableArray}from"../Core/Observable";import{ListBoxItemType}from"../ListBox";var GroupedItemProvider=function(){function e(e,t,r){this.listItems=new ObservableArray,this.internalGroups=__spreadArrays(t),this.groupedItems=[[]];for(s=0;s<this.internalGroups.length;s++)this.groupedItems.push([]);this.addItems(e);for(var s=0;s<this.internalGroups.length;s++)this.internalGroups[s].loading&&this.setGroupLoading(this.internalGroups[s].id,!0,this.internalGroups[s].loadingItem);r&&this.addHeaders(1,this.groups.length),this.manageHeaders=!!r}return Object.defineProperty(e.prototype,"groups",{get:function(){return this.internalGroups},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return this.listItems.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return this.listItems.value},enumerable:!0,configurable:!0}),e.prototype.subscribe=function(e,t){return this.listItems.subscribe(e,t)},e.prototype.unsubscribe=function(e,t){return this.listItems.unsubscribe(e,t)},e.prototype.push=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.addItems(e),e.length},e.prototype.pushGroups=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.addGroups.apply(this,__spreadArrays([this.internalGroups.length],e)),this.internalGroups.length},e.prototype.pop=function(){var e=this.listItems.pop();return e&&this.removeItems([e]),e},e.prototype.removeAll=function(e){var t=this.listItems.removeAll(e);return this.removeItems(t,!1),t},e.prototype.splice=function(e,t){for(var r=[],s=2;s<arguments.length;s++)r[s-2]=arguments[s];var i=this.listItems.splice(e,t);return this.removeItems(i,!1),this.addItems(r,!0,e),i},e.prototype.change=function(e){for(var t,r=[],s=1;s<arguments.length;s++)r[s-1]=arguments[s];var i=this.listItems.value.slice(e,r.length);return this.removeItems(i,!1),this.addItems(r,!1),(t=this.listItems).change.apply(t,__spreadArrays([e],r)),r.length},e.prototype.spliceGroups=function(e,t){for(var r=[],s=2;s<arguments.length;s++)r[s-2]=arguments[s];for(var i=0;i<t;i++){var o=e+i+1;if(this.groupedItems.length>o){if(this.removeItems(__spreadArrays(this.groupedItems[o])),this.manageHeaders){var n=this.groupedItems.findIndex(function(e){return e.length>0});n>0&&this.groupedItems[n][0].type===ListBoxItemType.Divider&&this.removeItems([this.groupedItems[n][0]])}this.groupedItems.splice(o,1)}}var p=this.internalGroups.splice(e,t);return this.addGroups.apply(this,__spreadArrays([e],r)),p},e.prototype.setGroupLoading=function(e,t,r){var s=this.groups.findIndex(function(t){return t.id===e});if(!(s<0)){s++;var i=this.groupedItems[s],o=i.findIndex(function(e){return e.type===ListBoxItemType.Loading});if(!t&&i.length&&o>-1)this.removeItems([i[o]]);else if(t&&-1===o){var n=r||{id:e+"-loading",type:ListBoxItemType.Loading,groupId:e};this.addItems([n])}this.groups[s-1].loading=t}},e.prototype.addHeaders=function(e,t){void 0===t&&(t=1);for(var r=function(e){var t=s.groups[e-1];if(s.groupedItems[e].length>0){s.groupedItems[e].find(function(e){return e.type===ListBoxItemType.Header})||s.addItems([{id:t.id+"-header",text:t.name||t.id,type:ListBoxItemType.Header,groupId:t.id}]),s.groupedItems.some(function(t,r){return r<e&&t.length>0})&&!s.groupedItems[e].find(function(e){return e.type===ListBoxItemType.Divider})&&s.addItems([{id:t.id+"-divider",type:ListBoxItemType.Divider,groupId:t.id}]);var r=s.groupedItems.findIndex(function(t,r){return r>e&&t.length>0});r>0&&!s.groupedItems[r].find(function(e){return e.type===ListBoxItemType.Divider})&&(t=s.groups[r-1],s.addItems([{id:t.id+"-divider",type:ListBoxItemType.Divider,groupId:t.id}]))}},s=this,i=e;i<e+t;i++)r(i)},e.prototype.addGroups=function(e){for(var t,r=[],s=1;s<arguments.length;s++)r[s-1]=arguments[s];(t=this.internalGroups).splice.apply(t,__spreadArrays([e,0],r));for(var i=[],o=0;o<r.length;o++){this.groupedItems.splice(e+o+1,0,[]);for(var n=this.groupedItems[0].length-1;n>=0;n--)if(this.groupedItems[0][n].groupId===r[o].id){var p=this.groupedItems[0].splice(n,1)[0];this.listItems.splice(n,1),i.unshift(p)}}this.addItems(i),this.manageHeaders&&this.addHeaders(e+1,r.length);for(o=0;o<r.length;o++)r[o].loading&&this.setGroupLoading(r[o].id,!0,r[o].loadingItem)},e.prototype.addItems=function(e,t,r){if(void 0===t&&(t=!0),void 0!==r)for(s=e.length-1;s>=0;s--)this.addItem(e[s],r);else for(var s=0;s<e.length;s++)this.addItem(e[s],r);t&&this.addToListItems()},e.prototype.addToListItems=function(){for(var e,t=[],r=0;r<this.groupedItems.length;r++)t.push.apply(t,this.groupedItems[r]);for(var s,i=0,o={},n=0;n<t.length;n++)this.listItems.value[i]===t[n]?(i++,s=void 0):void 0!==s?o[s].push(t[n]):(s=i,o[i]=[t[n]]);for(var p=Object.keys(o),r=p.length-1;r>=0;r--)(e=this.listItems).splice.apply(e,__spreadArrays([parseInt(p[r]),0],o[parseInt(p[r])]))},e.prototype.addItem=function(e,t){var r=0,s=0,i=e.groupId;void 0!==i&&(r=this.internalGroups.findIndex(function(e){return e.id===i})+1);for(var o=0;o<r;o++)s+=this.groupedItems[o].length;if(e.type===ListBoxItemType.Divider)this.groupedItems[r].unshift(e);else if(e.type===ListBoxItemType.Header)this.groupedItems[r].length&&this.groupedItems[r][0].type===ListBoxItemType.Divider?(this.groupedItems[r].splice(1,0,e),s++):this.groupedItems[r].unshift(e);else{var n=this.groupedItems[r].length;void 0!==t&&t>=s&&t<=s+this.groupedItems[r].length?(n=t-s,s=t):void 0!==t&&t<s?n=0:s+=this.groupedItems[r].length,this.groupedItems[r].splice(n,0,e),r>0&&1===this.groupedItems[r].length&&this.manageHeaders&&this.addHeaders(r)}},e.prototype.removeItems=function(e,t){void 0===t&&(t=!0);for(var r=function(r){var i=0,o=0,n=e[r].groupId;void 0!==n&&(i=s.internalGroups.findIndex(function(e){return e.id===n})+1);for(var p=0;p<i;p++)o+=s.groupedItems[p].length;var d=s.groupedItems[i],u=d.indexOf(e[r]);d.splice(u,1),t&&s.listItems.splice(o+u,1)},s=this,i=0;i<e.length;i++)r(i)},e}();export{GroupedItemProvider};