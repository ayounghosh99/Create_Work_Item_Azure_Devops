function adjustRanges(e,n,t){for(var s=[],i=0;i<t.length;i++){var l=t[i];if(e<=l.beginIndex)i>0&&l.beginIndex+n===t[i-1].endIndex+1?(t[i-1].endIndex=l.endIndex+n,t.splice(i--,1),s.push(t[i])):(l.beginIndex+=n,l.endIndex+=n,s.push(l));else if(e>l.beginIndex&&e<=l.endIndex){var d={beginIndex:e+n,endIndex:l.endIndex+n};t.splice(++i,0,d),s.push(d),l.endIndex=e-1,s.push(l)}}return s}import{__extends,__spreadArrays}from"tslib";import{ObservableValue}from"../Core/Observable";var Selection=function(e){function n(n){var t=e.call(this,[])||this;return t.selectedRanges=[],t.lockCount=0,t.unselectableRangesValue=[],t.selectedCount=0,t.unselectableCount=0,t.onItemsChanged=function(e,n){var s,i,l=e.index;if("change"!==n){if(e.removedItems&&e.removedItems.length&&(s=t.removeUnselectableInternal(l,e.removedItems.length),i=t.unselectInternal(l,e.removedItems.length)),e.addedItems||e.removedItems){var d=(e.addedItems?e.addedItems.length:0)-(e.removedItems?e.removedItems.length:0),a=adjustRanges(l,d,t.selectedRanges),c=adjustRanges(l,d,t.unselectableRanges);a.length&&t.notify(a,"set"),c.length&&t.notify(c,"setUnselectable")}s&&t.notify([s],"removeUnselectable"),i&&t.notify([i],"unselect")}},"boolean"==typeof n||void 0===n?t.multiSelect=!!n||!1:(t.alwaysMerge=!!n.alwaysMerge,t.multiSelect=!!n.multiSelect,t.unselectableRanges=n.unselectableRanges||[],t.value=n.selectedRanges||[]),t}return __extends(n,e),Object.defineProperty(n.prototype,"value",{get:function(){return this.selectedRanges},set:function(e){var n=this;this.selectedCount=0,this.selectedRanges=e.map(function(e){return n.selectedCount+=e.endIndex-e.beginIndex+1,{beginIndex:e.beginIndex,endIndex:e.endIndex}}),this.notify(e,"set")},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"unselectableRanges",{get:function(){return this.unselectableRangesValue},set:function(e){var n=this;this.unselectableCount=0,this.unselectableRangesValue=e.map(function(e){return n.unselectableCount+=e.endIndex-e.beginIndex+1,{beginIndex:e.beginIndex,endIndex:e.endIndex}}),this.notify(e,"setUnselectable")},enumerable:!0,configurable:!0}),n.prototype.clear=function(){var e=this.clearSelectedRanges();e&&this.notify(e,"unselect")},n.prototype.clearUnselectable=function(){var e=__spreadArrays(this.unselectableRangesValue);this.unselectableRanges=[],this.unselectableCount=0,this.notify(e,"removeUnselectable")},n.prototype.selectable=function(e){return!indexWithinRanges(e,this.unselectableRanges)},n.prototype.selected=function(e){return indexWithinRanges(e,this.selectedRanges)},n.prototype.addUnselectable=function(e,n){var t=!1,s=e,i=e+(n||1)-1;for(n=n||1;n>0;n--)if(this.selectable(e)){for(var l=0,d=void 0;l<this.unselectableRanges.length;l++){var a=this.unselectableRanges[l];if(e<a.beginIndex){e===a.beginIndex-1&&(d=a).beginIndex--;break}if(e===a.endIndex+1){l<this.unselectableRanges.length-1&&e===this.unselectableRanges[l+1].beginIndex-1?((d=a).endIndex=this.unselectableRanges[l+1].endIndex,this.unselectableRanges.splice(l+1,1)):(d=a).endIndex++;break}}d||(d={beginIndex:e,endIndex:e},this.unselectableRanges.splice(l,0,d)),t=!0,this.unselectableCount++,e++}else e++;t&&this.notify([{beginIndex:s,endIndex:i}],"addUnselectable")},n.prototype.removeUnselectable=function(e,n){var t=this.removeUnselectableInternal(e,n);t&&this.notify([t],"removeUnselectable")},n.prototype.select=function(e,n,t,s){if(void 0===t&&(t=this.alwaysMerge),void 0===s&&(s=this.multiSelect),!this.lockCount){var i=e,l=i+(n||1)-1,d=!1,a=void 0;if(s)for(t||(a=this.clearSelectedRanges()),n=n||1;n>0;n--)if(!this.selected(e)&&this.selectable(e)){for(var c=0,o=void 0;c<this.selectedRanges.length;c++){var r=this.selectedRanges[c];if(e<r.beginIndex){e===r.beginIndex-1&&(o=r).beginIndex--;break}if(e===r.endIndex+1){c<this.selectedRanges.length-1&&e===this.selectedRanges[c+1].beginIndex-1?((o=r).endIndex=this.selectedRanges[c+1].endIndex,this.selectedRanges.splice(c+1,1)):(o=r).endIndex++;break}}o||(o={beginIndex:e,endIndex:e},this.selectedRanges.splice(c,0,o)),this.selectedCount++,e++,d=!0}else e++;else if(!this.selected(e)&&this.selectable(e)){a=this.clearSelectedRanges();o={beginIndex:e,endIndex:e};this.selectedRanges.push(o),this.selectedCount++,d=!0}a&&this.notify(a,"unselect"),d&&this.notify([{beginIndex:i,endIndex:l}],"select")}},n.prototype.toggle=function(e,n,t){void 0===n&&(n=this.alwaysMerge),void 0===t&&(t=this.multiSelect),this.selected(e)?this.unselect(e):this.select(e,1,n,t)},n.prototype.unselect=function(e,n){var t=this.unselectInternal(e,n);t&&this.notify([t],"unselect")},n.prototype.lock=function(){this.lockCount++},n.prototype.unlock=function(){this.lockCount--},n.prototype.removeUnselectableInternal=function(e,n){var t=e,s=t+(n||1)-1,i=!1;for(n=n||1;n>0;n--)if(this.selectable(e))e++;else{for(var l=0;l<this.unselectableRanges.length;l++){var d=this.unselectableRanges[l];if(!(e<d.beginIndex)&&(e>=d.beginIndex&&e<=d.endIndex)){e===d.beginIndex?d.beginIndex++:e===d.endIndex?d.endIndex--:(this.unselectableRanges.splice(l+1,0,{beginIndex:e+1,endIndex:d.endIndex}),d.endIndex=e-1),d.beginIndex>d.endIndex&&this.unselectableRanges.splice(l,1),this.unselectableCount--,i=!0;break}}e++}if(i)return{beginIndex:t,endIndex:s}},n.prototype.unselectInternal=function(e,n){var t=!1,s=e,i=s+(n||1)-1;if(!this.lockCount)for(n=n||1;n>0;n--)if(this.selected(e)){for(var l=0;l<this.selectedRanges.length;l++){var d=this.selectedRanges[l];if(!(e<d.beginIndex)&&(e>=d.beginIndex&&e<=d.endIndex)){e===d.beginIndex?d.beginIndex++:e===d.endIndex?d.endIndex--:(this.selectedRanges.splice(l+1,0,{beginIndex:e+1,endIndex:d.endIndex}),d.endIndex=e-1),d.beginIndex>d.endIndex&&this.selectedRanges.splice(l,1),this.selectedCount--,t=!0;break}}e++}else e++;if(t)return{beginIndex:s,endIndex:i}},n.prototype.clearSelectedRanges=function(){if(!this.lockCount&&this.selectedRanges.length>0){var e=__spreadArrays(this.selectedRanges);return this.selectedRanges=[],this.selectedCount=0,e}},n}(ObservableValue);export{Selection};export function indexWithinRanges(e,n){if(n)for(var t=0,s=n;t<s.length;t++){var i=s[t];if(e>=i.beginIndex&&e<=i.endIndex)return!0}return!1};export function compareSelectionRanges(e,n){for(var t=[],s=0;s<e.length;s++)for(l=(i=e[s]).beginIndex;l<=i.endIndex;l++)indexWithinRanges(l,n)||t.push(-1*l);for(s=0;s<n.length;s++)for(var i=n[s],l=i.beginIndex;l<=i.endIndex;l++)indexWithinRanges(l,e)||t.push(l);return t};