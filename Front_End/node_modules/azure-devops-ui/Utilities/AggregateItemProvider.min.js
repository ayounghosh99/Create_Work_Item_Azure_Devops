import{__extends,__spreadArrays}from"tslib";import{Observable,ObservableLike}from"../Core/Observable";var AggregateItemProvider=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.internalCollections=[],t.items=[],t}return __extends(t,e),Object.defineProperty(t.prototype,"length",{get:function(){return this.items.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this.items},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"collections",{get:function(){return this.internalCollections},enumerable:!0,configurable:!0}),t.prototype.push=function(e){var t,r;if(ObservableLike.isObservable(e)){var i=e,s=this.getSubscriber(this.internalCollections.length);r={items:i.value,provider:i,subscriber:s},this.subscriberCount&&ObservableLike.subscribe(r.provider,s)}else e.value?r={items:e.value,provider:e}:e.length&&(r={items:e});r&&(this.internalCollections.push(r),r.items.length&&((t=this.items).push.apply(t,r.items),this.subscriberCount&&this.notify({addedItems:r.items,index:this.items.length-r.items.length},"push")))},t.prototype.getItem=function(e){for(var t=0;t<this.internalCollections.length&&0+(this.internalCollections[t].provider?this.internalCollections[t].provider.length:this.internalCollections[t].items.length)<e;)t++;if(t<this.internalCollections.length)return this.internalCollections[t].provider&&this.internalCollections[t].provider.getItem?this.internalCollections[t].provider.getItem(e):this.internalCollections[t].items[e]},t.prototype.subscribe=function(t,r){var i,s=e.prototype.subscribe.call(this,t,r);if(1===this.subscriberCount){for(var n=0,o=this.internalCollections;n<o.length;n++){(p=o[n]).subscriber&&p.provider&&p.provider.subscribe&&p.provider.subscribe(p.subscriber)}for(var l=[],a=0,c=this.internalCollections;a<c.length;a++){var p=c[a];l.push.apply(l,p.items)}(i=this.items).splice.apply(i,__spreadArrays([0,this.items.length],l))}return s},t.prototype.unsubscribe=function(t,r){if(e.prototype.unsubscribe.call(this,t,r),0===this.subscriberCount)for(var i=0,s=this.internalCollections;i<s.length;i++){var n=s[i];n.subscriber&&n.provider&&n.provider.unsubscribe&&n.provider.unsubscribe(n.subscriber)}},t.prototype.getSubscriber=function(e){var t=this;return function(r){for(var i,s,n=r.index,o=0;o<e;o++)n+=t.internalCollections[o].items.length;if(r.changedItems)(i=t.items).splice.apply(i,__spreadArrays([n,r.changedItems.length],r.changedItems)),t.notify({changedItems:r.changedItems,index:n},"change");else{var l=r.removedItems||[],a=r.addedItems||[];(s=t.items).splice.apply(s,__spreadArrays([n,l.length],a)),t.notify({removedItems:l,addedItems:a,index:n},"splice")}}},t}(Observable);export{AggregateItemProvider};