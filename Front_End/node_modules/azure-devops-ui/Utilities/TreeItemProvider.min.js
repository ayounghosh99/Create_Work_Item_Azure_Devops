import{__spreadArrays}from"tslib";import{ObservableArray}from"../Core/Observable";var TreeItemProvider=function(){function e(e){void 0===e&&(e=[]),this.itemMap=new Map;var t=[];this.rootItems=__spreadArrays(e),this.addItems(e,void 0,t),this.tableItems=new ObservableArray(t)}return Object.defineProperty(e.prototype,"length",{get:function(){return this.tableItems.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"roots",{get:function(){return this.rootItems},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return this.tableItems.value},enumerable:!0,configurable:!0}),e.prototype.subscribe=function(e,t){return this.tableItems.subscribe(e,t)},e.prototype.unsubscribe=function(e,t){return this.tableItems.unsubscribe(e,t)},e.prototype.add=function(e,t,i){return this.splice(t,void 0,[{insertAfter:i,items:[e]}])},e.prototype.clear=function(){this.tableItems.splice(0,this.tableItems.length),this.rootItems.splice(0,this.rootItems.length)},e.prototype.collapse=function(e){e.expanded&&this.toggle(e)},e.prototype.expand=function(e,t){var i=this.itemMap.get(e);if(i){var r=[];do{i.underlyingItem.expanded||r.push(i),i=i.parentItem}while(t&&i);for(var s=r.length-1;s>=0;s--)this.toggle(r[s].underlyingItem)}},e.prototype.remove=function(e,t){if(!t){var i=this.indexOf(e);if(-1===(i=this.indexOf(e)))return;var r=this.tableItems.value[i];t=r.parentItem&&r.parentItem.underlyingItem}return this.splice(t,[e])},e.prototype.splice=function(e,t,i){var r,s,n=!1,o=-1,a=this.rootItems;if(e){if(!(s=this.itemMap.get(e)))return;o=this.indexOf(e),a=s.underlyingItem.childItems||[]}if(t&&(t=t.slice(0)),i)for(f=0;f<i.length;f++){var l=!e||o>=0&&e.expanded?[]:void 0,d=i[f],p=o,h=0;if(d.insertAfter){if(-1===(h=a.indexOf(d.insertAfter)))continue;var m=this.indexOf(d.insertAfter,o+1);-1!==m&&(p=m+this.getTableChildCount(d.insertAfter))}this.addItems(d.items,s,l),a.splice.apply(a,__spreadArrays([h+1,0],d.items)),s&&!s.underlyingItem.childItems&&(s.underlyingItem.childItems=a,n=!0),l&&((r=this.tableItems).splice.apply(r,__spreadArrays([p+1,0],l)),n=!0)}if(t)for(var f=0;f<t.length;f++){var u=t[f],l=!e||e.expanded?[]:void 0,h=void 0;if(-1!==(h=a.indexOf(u))){this.removeItem(u,l),a.splice(h,1),0===a.length&&e&&(delete e.childItems,n=!0);var c=this.indexOf(u,o+1);-1!==c&&l&&(this.tableItems.splice(c,l.length),n=!0)}}n&&s&&-1!==o&&this.tableItems.change(o,s)},e.prototype.toggle=function(e){var t,i=this.indexOf(e);if(i>=0&&(e.expanded=!e.expanded,e.childItems)){for(var r=[],s=0;s<e.childItems.length;s++)this.getTableItems(e.childItems[s],r);e.expanded?(t=this.tableItems).splice.apply(t,__spreadArrays([i+1,0],r)):this.tableItems.splice(i+1,r.length)}},e.prototype.addItems=function(e,t,i){for(var r=0;r<e.length;r++){var s=e[r],n={depth:t?t.depth+1:0,parentItem:t,underlyingItem:s};this.itemMap.set(s,n),i&&i.push(n),s.childItems&&this.addItems(s.childItems,n,s.expanded?i:void 0)}},e.prototype.getTableItems=function(e,t){var i=this.itemMap.get(e);if(i&&(t.push(i),e.childItems&&e.expanded))for(var r=0,s=e.childItems;r<s.length;r++){var n=s[r];this.getTableItems(n,t)}},e.prototype.getTableChildCount=function(e){var t=0;if(e.childItems&&e.expanded)for(var i=0;i<e.childItems.length;i++)t+=this.getTableChildCount(e.childItems[i])+1;return t},e.prototype.indexOf=function(e,t){void 0===t&&(t=0);for(var i=t;i<this.tableItems.length;i++)if(e===this.tableItems.value[i].underlyingItem)return i;return-1},e.prototype.removeItem=function(e,t){if(this.itemMap.delete(e),t&&t.push(e),e.childItems)for(var i=0;i<e.childItems.length;i++)this.removeItem(e.childItems[i],e.expanded?t:void 0)},e}();export{TreeItemProvider};