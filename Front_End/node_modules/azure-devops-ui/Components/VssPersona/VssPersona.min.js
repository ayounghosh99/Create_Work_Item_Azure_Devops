import{__assign,__extends}from"tslib";import"../../CommonImports";import"../../Core/core.css";import"./VssPersona.css";import*as React from"react";import{Icon}from"../../Icon";import{Tooltip}from"../../TooltipEx";import{css,KeyCode}from"../../Util";import{getColorString}from"../../Utilities/Color";import{getInitialsColorFromName,getInitialsFromName}from"./VssPersona.Initials";var VssPersona=function(e){function r(r){var t=e.call(this,r)||this;return t.setTargetElement=function(e){t.targetElement=e},t.onImageError=function(e){t.props.showInitialsOnImageError?t.setState({imageError:!0}):t.props.onImageError&&t.props.onImageError(e)},t.handleKeyDown=function(e){e.keyCode!==KeyCode.enter&&e.keyCode!==KeyCode.space||t.showPersonaCard()},t.showPersonaCard=function(){t.props.suppressPersonaCard||t.setState({showPersonaCard:!0})},t.hidePersonaCard=function(){t.setState({showPersonaCard:!1})},t.state={imageError:!1,showPersonaCard:!1,imageUrlVal:t._getImageUrl(r)},t}return __extends(r,e),r.prototype.UNSAFE_componentWillReceiveProps=function(e){this.setState({showPersonaCard:!1,imageUrlVal:this._getImageUrl(e)})},r.prototype.shouldComponentUpdate=function(e,r){return!(e.identityDetailsProvider||this.props.imageUrl===e.imageUrl&&this.props.displayName===e.displayName)||!(!this.props.identityDetailsProvider&&!e.identityDetailsProvider)&&(!this.props.identityDetailsProvider||!e.identityDetailsProvider||(this.props.size!==e.size||this.props.cssClass!==e.cssClass||this.props.identityDetailsProvider!==e.identityDetailsProvider||this.state.showPersonaCard!==r.showPersonaCard))},r.prototype.render=function(){var e=this.props,r=e.ariaLabel,t=e.identityDetailsProvider,s=e.size,a=void 0===s?"medium":s,o=e.imgAltText,i=void 0===o?"":o,n=e.imageUrl,l=e.displayName,m=t?this.state.imageUrlVal:n,p={};p.role="img",this.props.dataIsFocusable&&(p["data-is-focusable"]=!0),this.props.isTabStop&&(p.tabIndex=0),!this.props.suppressPersonaCard&&this.props.identityDetailsProvider&&this.props.identityDetailsProvider.onRenderPersonaCard&&(p["aria-expanded"]=this.state.showPersonaCard,p.onKeyDown=this.handleKeyDown,p.onClick=this.showPersonaCard,p.role="button");var d=t?t.getDisplayName():l;r?p["aria-label"]=r:d?p["aria-label"]=d:p["aria-hidden"]="true";var c=void 0===d?void 0:getInitialsColorFromName(d),h=void 0===m||this.state.imageError?React.createElement("div",{className:css("vss-Persona-content",a),style:c&&{background:getColorString(c)}},d?React.createElement("span",null,getInitialsFromName(d)):React.createElement(Icon,{iconName:"Contact"})):React.createElement("img",{className:"vss-Persona-content using-image",src:m,alt:i,onError:this.onImageError});return React.createElement(React.Fragment,null,React.createElement(Tooltip,{text:l,showOnFocus:!0},React.createElement("div",__assign({className:css("vss-Persona flex-noshrink",this.props.className,this.props.cssClass,a),ref:this.setTargetElement},p),h)),!this.props.suppressPersonaCard&&this.state.showPersonaCard&&t&&t.onRenderPersonaCard&&t.onRenderPersonaCard(this.targetElement,this.hidePersonaCard))},r.prototype._getImageUrl=function(e){var r=e.identityDetailsProvider,t=e.size,s=void 0===t?"medium":t,a=this._getSize(s);return r&&r.getIdentityImageUrl(a)},r.prototype._getSize=function(e){switch(e){case"extra-extra-small":return 16;case"extra-small":return 18;case"extra-small-plus":return 20;case"small":return 24;case"small-plus":return 28;case"medium":return 32;case"medium-plus":return 40;default:case"large":return 48;case"extra-large":return 72;case"extra-extra-large":return 100}},r}(React.Component);export{VssPersona};