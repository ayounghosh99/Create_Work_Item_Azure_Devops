import{__assign,__extends}from"tslib";import"../../CommonImports";import"../../Core/core.css";import"./Callout.css";import*as React from"react";import{FocusWithin}from"../../FocusWithin";import{FocusZone}from"../../FocusZone";import{Portal}from"../../Portal";import{css,getSafeId,KeyCode}from"../../Util";import{Location,position,updateLayout}from"../../Utilities/Position";import{TimerManagement}from"../../Core/TimerManagement";import{SurfaceBackground,SurfaceContext}from"../../Surface";import{ContentJustification,ContentLocation,ContentOrientation,ContentSize}from"./Callout.Props";var Callout=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.calloutContent=React.createRef(),e}return __extends(e,t),e.prototype.render=function(){var t=this.props.portalProps;return React.createElement(Portal,__assign({},t,{className:css(t&&t.className,this.props.anchorElement&&"bolt-layout-relative")}),React.createElement(CalloutContent,__assign({ref:this.calloutContent},this.props)))},e.prototype.componentWillUnmount=function(){this.calloutContent.current&&this.calloutContent.current.portalWillUnmount()},e.prototype.updateLayout=function(){this.calloutContent.current&&this.calloutContent.current.updateLayout()},e.defaultProps={blurDismiss:!1,viewportChangeDismiss:!0},e}(React.Component);export{Callout};var CalloutContent=function(t){function e(e){var o=t.call(this,e)||this;return o.calloutElement=React.createRef(),o.relayoutTimer=new TimerManagement,o.scrollListen=!1,o.scrollEvent=null,o.initialScreenWidth=window.innerWidth,o.onBlur=function(){o.props.onDismiss&&o.props.onDismiss()},o.onClick=function(t){o.props.lightDismiss&&!t.defaultPrevented&&(o.props.onDismiss&&o.props.onDismiss(),t.preventDefault())},o.onKeyDown=function(t){o.props.escDismiss&&t.which===KeyCode.escape&&!t.defaultPrevented&&(o.props.onDismiss&&o.props.onDismiss(),t.preventDefault())},o.onResize=function(){!0!==o.props.viewportChangeDismiss||o.initialScreenWidth===window.innerWidth&&document.activeElement&&("INPUT"===document.activeElement.tagName||"TEXTAREA"===document.activeElement.tagName)?o.props.updateLayout&&(o.relayoutTimer.clearAllTimers(),o.relayoutTimer.setTimeout(function(){o.updateLayout()},200)):o.props.onDismiss&&o.props.onDismiss()},o.onScroll=function(t){o.scrollListen&&(o.scrollEvent=t.nativeEvent)},o.onScrollDocument=function(t){if(o.scrollListen)if(t===o.scrollEvent)o.scrollEvent=null;else if(!0===o.props.viewportChangeDismiss){var e=o.props.anchorElement;t.target&&e&&t.target.contains(e)&&o.props.onDismiss&&o.props.onDismiss()}else o.props.updateLayout&&o.relayoutTimer.setTimeout(function(){o.updateLayout()},50)},o.focusElement=document.activeElement,o.contentElement=e.contentRef||React.createRef(),o}return __extends(e,t),e.prototype.render=function(){var t,e=this,o=this.props,n=o.blurDismiss,i=o.contentJustification,r=o.contentLocation,s=o.contentOrientation,a=o.focuszoneProps,l=o.lightDismiss,c=o.modal,u=o.onAnimationEnd,p=o.onMouseEnter,m=o.onMouseLeave,h=o.anchorElement;n&&a?t=React.createElement(FocusWithin,{onBlur:this.onBlur,updateStateOnFocusChange:!1},function(t){return React.createElement(FocusZone,__assign({},a),e.renderContent(t.onFocus,t.onBlur))}):(t=this.renderContent(),n&&(t=React.createElement(FocusWithin,{onBlur:this.onBlur,updateStateOnFocusChange:!1},t)),a&&(t=React.createElement(FocusZone,__assign({},a),t)));var d=l?React.createElement("div",{className:css("absolute-fill bolt-light-dismiss",c&&"bolt-callout-modal"),onClick:this.onClick}):null;return React.createElement(SurfaceContext.Provider,{value:{background:SurfaceBackground.callout}},React.createElement("div",{className:"flex-row flex-grow"},React.createElement("div",{className:css(this.props.className,"bolt-callout absolute",void 0!==r&&"absolute-fill",i===ContentJustification.Start&&"justify-start",i===ContentJustification.Center&&"justify-center",i===ContentJustification.End&&"justify-end",r===ContentLocation.Start&&"flex-start",r===ContentLocation.Center&&"flex-center",r===ContentLocation.End&&"flex-end",s===ContentOrientation.Column&&"flex-column",s!==ContentOrientation.Column&&"flex-row",c&&!l&&"bolt-callout-modal"),id:getSafeId(this.props.id),onAnimationEnd:u,onMouseEnter:p,onMouseLeave:m,onKeyDown:this.onKeyDown,ref:this.calloutElement,role:this.props.role},!h&&d,t),!!h&&d))},e.prototype.componentDidMount=function(){this.updateLayout(),this.props.anchorElement&&(window.addEventListener("resize",this.onResize),document.addEventListener("scroll",this.onScrollDocument,!0),this.scrollListen=!0)},e.prototype.componentDidUpdate=function(){this.props.updateLayout&&this.updateLayout()},e.prototype.componentWillUnmount=function(){this.scrollListen&&(document.removeEventListener("scroll",this.onScrollDocument,!0),window.removeEventListener("resize",this.onResize)),this.relayoutTimer&&this.relayoutTimer.clearAllTimers()},e.prototype.portalWillUnmount=function(){var t=this.contentElement.current,e=this.focusElement;e&&t&&t.contains(document.activeElement)&&window.setTimeout(function(){(t.contains(document.activeElement)||document.activeElement===document.body||null===document.activeElement)&&e.focus()},0)},e.prototype.updateLayout=function(){void 0===this.props.contentLocation&&this.calloutElement.current&&(position(this.calloutElement.current,this.props.calloutOrigin||{horizontal:Location.start,vertical:Location.start},this.props.anchorOffset,this.props.anchorElement,this.props.anchorOrigin,this.props.anchorPoint,this.props.anchorElement?5e3:0),this.props.fixedLayout||updateLayout(this.calloutElement.current,this.props.calloutOrigin||{horizontal:Location.start,vertical:Location.start},this.props.anchorOffset,this.props.anchorElement,this.props.anchorOrigin,this.props.anchorPoint,this.props.anchorElement?5e3:0))},e.prototype.renderContent=function(t,e){var o=this.props,n=o.contentJustification,i=o.contentOrientation,r=o.contentSize,s=o.height,a=o.width;return React.createElement("div",{"aria-describedby":getSafeId(this.props.ariaDescribedBy),"aria-label":this.props.ariaLabel,"aria-labelledby":getSafeId(this.props.ariaLabelledBy),"aria-modal":this.props.modal,className:css(this.props.contentClassName,"bolt-callout-content",this.props.contentShadow&&"bolt-callout-shadow",n===ContentJustification.Stretch&&"flex-grow",i===ContentOrientation.Column&&"flex-column",i===ContentOrientation.Row&&"flex-row",r===ContentSize.Small&&"bolt-callout-small",r===ContentSize.Medium&&"bolt-callout-medium",r===ContentSize.Large&&"bolt-callout-large",r===ContentSize.ExtraLarge&&"bolt-callout-extra-large",r===ContentSize.Auto&&"bolt-callout-auto"),onBlur:e,onFocus:t,onScroll:this.onScroll,ref:this.contentElement,role:this.props.role||"dialog",style:{height:s,width:a}},this.props.children)},e}(React.Component);