import{__assign,__extends,__spreadArrays}from"tslib";import"../../CommonImports";import"../../Core/core.css";import"./HeaderCommandBar.css";import*as React from"react";import{ObservableLike}from"../../Core/Observable";import{Button}from"../../Button";import{MenuButton,MenuItemType}from"../../Menu";import{OverflowButton,ResizeGroup}from"../../ResizeGroup";import{css}from"../../Util";import{FILTER_CHANGE_EVENT}from"../../Utilities/Filter";import{CustomHeaderCommandBar}from"./CustomHeaderCommandBar";import{getFilterItem}from"./Items";var headerCommandBarId=1,HeaderCommandBar=function(e){function t(t){var r=e.call(this,t)||this;return r.overflowButtonRef=React.createRef(),r.buttonRefs={},r.moreButtonId=t.moreButtonId||"header-command-bar-menu-button"+headerCommandBarId++,r}return __extends(t,e),t.prototype.render=function(){var e,t=this,r=this.props.items,o=r.sort(function(e,t){var r,o,n=null!==(r=e.rank)&&void 0!==r?r:Number.MAX_VALUE,a=null!==(o=t.rank)&&void 0!==o?o:Number.MAX_VALUE;return n>a?1:n<a?-1:0}),n="";this.buttonRefs={};var a=[],s=[],i=[],m=[],u=null!==(e=this.props.buttonCount)&&void 0!==e?e:3,l=!r.length||"button"!==r[0].role;return o.forEach(function(e,r){var o=e.id;if(e.itemType===MenuItemType.Divider)e.important?a.push(React.createElement("div",{className:"bolt-header-command-item-separator",key:o})):i.push(e);else{var l={ariaChecked:ObservableLike.getValue(e.checked),ariaLabel:e.ariaLabel,ariaRoleDescription:e.href?"link":"button",className:css(e.className,"bolt-header-command-item-button"),disabled:e.disabled,href:e.href,iconProps:e.iconProps,id:o,primary:e.isPrimary,role:e.role||"menuitem",subtle:e.subtle,target:e.target,text:e.text,tooltipProps:e.tooltipProps};if(!1===e.important||void 0===e.important&&0===u)return void i.push(e);void 0===e.important&&(m.push(r),s.push(e)),u--;var p=Button,d=React.createRef();t.buttonRefs[o]=d,e.subMenuProps?(l.contextualMenuProps={menuProps:e.subMenuProps},l.hideDropdownIcon=e.hideDropdownIcon,p=MenuButton):l.onClick=function(t){return e.onActivate&&e.onActivate(e,t)},n||e.disabled||(n=o),e.renderButton?a.push(e.renderButton(l)):a.push(React.createElement(p,__assign({},l,{key:o,ref:d})))}}),a.push(React.createElement(OverflowButton,{className:css(this.props.overflowClassName,"bolt-header-command-item-button"),id:this.moreButtonId,key:this.moreButtonId,role:"menuitem",ref:this.overflowButtonRef})),this.buttonRefs[this.moreButtonId]=this.overflowButtonRef,r.length>0?React.createElement(CustomHeaderCommandBar,{className:this.props.className,focusGroupProps:{defaultElementId:n||this.moreButtonId},role:l?"menubar":void 0},React.createElement(ResizeGroup,{responsiveLayoutProps:{responsiveChildren:m.reverse()},overflowMenuItems:s.reverse(),extraItems:i},React.createElement("div",{className:css(this.props.className,"flex-row flex-center flex-grow scroll-hidden justify-end rhythm-horizontal-8")},a))):null},t.prototype.focus=function(e){var t=this.buttonRefs[e.commandBarItemId];t&&t.current&&t.current.focus()},t}(React.Component);export{HeaderCommandBar};var HeaderCommandBarWithFilter=function(e){function t(t){var r=e.call(this,t)||this;return r.headerCommandBarRef=React.createRef(),r.onFilterClicked=function(){r.props.filterToggled.value=!r.props.filterToggled.value},r.onFilterChanged=function(){var e=r.props.filter.hasChangesToReset();e!==r.state.filterHasChanges&&r.setState({filterHasChanges:e})},r.state={filterHasChanges:r.props.filter.hasChangesToReset()},r}return __extends(t,e),t.prototype.componentDidMount=function(){this.props.filter.subscribe(this.onFilterChanged,FILTER_CHANGE_EVENT)},t.prototype.componentWillUnmount=function(){this.props.filter.unsubscribe(this.onFilterChanged,FILTER_CHANGE_EVENT)},t.prototype.render=function(){var e=this.props.items?__spreadArrays(this.props.items):[];return e.push(getFilterItem(this.onFilterClicked,this.state.filterHasChanges)),React.createElement(HeaderCommandBar,__assign({},this.props,{items:e,ref:this.headerCommandBarRef}))},t.prototype.focus=function(e){this.headerCommandBarRef.current&&this.headerCommandBarRef.current.focus(e)},t}(React.Component);export{HeaderCommandBarWithFilter};