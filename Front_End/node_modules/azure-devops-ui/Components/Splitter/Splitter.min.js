import{__extends}from"tslib";import"../../CommonImports";import"../../Core/core.css";import"./Splitter.css";import*as React from"react";import{EventManagement}from"../../Core/EventManagement";import{ObservableLike,ObservableValue}from"../../Core/Observable";import{announce}from"../../Core/Util/Accessibility";import{format}from"../../Core/Util/String";import{Button}from"../../Button";import{Observer}from"../../Observer";import*as Resources from"../../Resources.Splitter";import{css,getSafeId,KeyCode}from"../../Util";import{SplitterDirection,SplitterElementPosition}from"../../Components/Splitter/Splitter.Props";var DIVIDER_MOVE_INCREMENT=20,DIVIDER_WIDTH=4,COLLAPSED_PANE_SIZE=38,idCount=0,Splitter=function(e){function t(t,i){var n=e.call(this,t,i)||this;return n._cachedNearElement=null,n._cachedFarElement=null,n.events=new EventManagement,n.uncontrolledFixedSize=new ObservableValue(void 0),n.placeholderPosition=new ObservableValue(void 0),n.collapse=function(){n.isCollapsed()||(n.props.onCollapsedChanged&&n.props.onCollapsedChanged(!0),announce(Resources.SplitterCollapsed))},n.expand=function(){n.isCollapsed()&&(n.props.onCollapsedChanged&&n.props.onCollapsedChanged(!1),announce(Resources.SplitterExpanded))},n._onDividerKeyDown=function(e){var t=n.props,i=t.disabled,o=t.splitterDirection;if(!i&&!n._isDragging()){switch(e.keyCode){case KeyCode.leftArrow:o===SplitterDirection.Vertical&&n._moveDivider(-DIVIDER_MOVE_INCREMENT);break;case KeyCode.rightArrow:o===SplitterDirection.Vertical&&n._moveDivider(DIVIDER_MOVE_INCREMENT);break;case KeyCode.upArrow:o===SplitterDirection.Horizontal&&n._moveDivider(-DIVIDER_MOVE_INCREMENT);break;case KeyCode.downArrow:o===SplitterDirection.Horizontal&&n._moveDivider(DIVIDER_MOVE_INCREMENT);break;default:return}e.preventDefault(),e.stopPropagation()}},n._onDividerMouseDown=function(e){n._onDividerDown(e,e.clientX,e.clientY),n._attachMouseWindowEvents()},n._onDividerTouchDown=function(e){1===e.touches.length&&(n._onDividerDown(e,e.touches[0].clientX,e.touches[0].clientY),n._attachTouchWindowEvents())},n._onDividerDown=function(e,t,i){n._fixedRef&&!n.props.disabled&&(e.preventDefault(),e.stopPropagation(),n._dragAnchorPos=n._getEventBoundedClientPos(t,i),n._previousFixedSize=n._getElementSize(n._fixedRef),void 0!==n.placeholderPosition.value&&(n.placeholderPosition.value=void 0),n._handleDragEvent(e,t,i))},n._onDividerMouseMove=function(e){n._handleDragEvent(e,e.clientX,e.clientY)},n._onDividerTouchMove=function(e){1===e.touches.length&&n._handleDragEvent(e,e.touches[0].clientX,e.touches[0].clientY)},n._onDividerMouseUp=function(e){n._detachMouseWindowEvents(),n._onDividerEnd(e.clientX,e.clientY)},n._onDividerTouchEnd=function(e){n._detachTouchWindowEvents(),n._onDividerEnd(e.changedTouches[0].clientX,e.changedTouches[0].clientY)},n._onDividerEnd=function(e,t){var i=n._getEventBoundedClientPos(e,t),o=n._getNewFixedSize(n._previousFixedSize,i-n._dragAnchorPos);n.placeholderPosition.value=void 0,n._setFixedSize(o),n._fireWindowResize()},n.uncontrolledFixedSize.value=t.initialFixedSize,n.fixedPaneId="splitter-fixed-pane"+idCount++,n}return __extends(t,e),t.prototype.componentDidMount=function(){this._fireWindowResize()},t.prototype.componentWillUnmount=function(){this.events.removeAllListeners()},t.prototype.render=function(){var e=this,t=this.props,i=t.className,n=t.collapsed,o=t.fixedElement,r=t.maxFixedSize,s=t.minFixedSize,a=t.onRenderFarElement,l=t.onRenderNearElement,d=t.splitterDirection,p=o===SplitterElementPosition.Near?!!l:!!a;return React.createElement(Observer,{collapsed:n,fixedSize:void 0===this.props.fixedSize?this.uncontrolledFixedSize:this.props.fixedSize,placeholderPosition:this.placeholderPosition},function(t){var n;if(t.collapsed)n=COLLAPSED_PANE_SIZE;else if(t.fixedSize){n=Math.max(t.fixedSize,s||0);var o=r;!o&&e._splitterContainer&&(o=e._getElementSize(e._splitterContainer)),o&&n>o&&(n=o)}else void 0!==s?n=s:void 0!==r&&(n=r);return React.createElement("div",{className:css(i,"vss-Splitter--container",d===SplitterDirection.Vertical&&"vss-Splitter--container-row",d===SplitterDirection.Horizontal&&"vss-Splitter--container-column",e._isDragging()&&"vss-Splitter--container-dragging"),ref:function(t){return e._splitterContainer=t}},e._renderNearElement(n),p?e._renderDivider(n):null,e._renderDragPlaceHolder(),e._renderFarElement(n))})},t.prototype._renderNearElement=function(e){var t=this.props,i=t.fixedElement,n=t.onRenderNearElement,o=t.nearElementClassName;if(!this._isDragging()||!this._cachedNearElement)if(n){var r=n();this._cachedNearElement=i===SplitterElementPosition.Near?this._renderFixedPane(r,o,e):this._renderFlexiblePane(r,o)}else this._cachedNearElement=null;return this._cachedNearElement},t.prototype._renderFarElement=function(e){var t=this.props,i=t.fixedElement,n=t.onRenderFarElement,o=t.farElementClassName;if(!this._isDragging()||!this._cachedFarElement)if(n){var r=n();this._cachedFarElement=i===SplitterElementPosition.Far?this._renderFixedPane(r,o,e):this._renderFlexiblePane(r,o)}else this._cachedFarElement=null;return this._cachedFarElement},t.prototype._renderFixedPane=function(e,t,i){var n,o=this,r=this.props,s=r.expandTooltip,a=r.splitterDirection,l=this.isCollapsed(),d=(n={},n[a===SplitterDirection.Vertical?"width":"height"]=void 0===i?"50%":i,n);return e?React.createElement("div",{className:css("vss-Splitter--pane-fixed",l?"flex-column collapsed":t),id:getSafeId(this.fixedPaneId),style:d,ref:function(e){return o._fixedRef=e}},l?React.createElement(Button,{className:"vss-splitter-expand-button",iconProps:{iconName:this.getCollapsedButtonIconName()},onClick:this.expand,subtle:!0,tooltipProps:{text:s||Resources.ExpandTooltip}}):e):null},t.prototype.getCollapsedButtonIconName=function(){var e=this.props.fixedElement===SplitterElementPosition.Far;return this.props.splitterDirection===SplitterDirection.Vertical?e?"DoubleChevronLeft":"DoubleChevronRight":e?"DoubleChevronUp":"DoubleChevronDown"},t.prototype._renderFlexiblePane=function(e,t){return React.createElement("div",{className:css("vss-Splitter--pane-flexible",t)},e)},t.prototype._renderDivider=function(e){var t=this._getSplitterBoundaries(),i=t.startBound,n=t.endBound;return React.createElement("div",{"aria-valuemin":i,"aria-valuemax":n,"aria-label":this.props.ariaLabel,"aria-labelledby":this.props.ariaLabel?void 0:this.props.ariaLabelledBy?this.props.ariaLabelledBy:getSafeId(this.fixedPaneId),"aria-orientation":this.props.splitterDirection===SplitterDirection.Horizontal?"horizontal":"vertical","aria-valuenow":e,"aria-valuetext":e?format(Resources.SplitterValueText,e):void 0,role:"separator",tabIndex:0,className:css("vss-Splitter--divider",this._isDragging()&&"vss-Splitter--divider-dragging"),onKeyDown:this._onDividerKeyDown,onMouseDown:this._onDividerMouseDown,onTouchStart:this._onDividerTouchDown})},t.prototype._renderDragPlaceHolder=function(){var e;if(this._isDragging()){var t=(e={},e[this.props.splitterDirection===SplitterDirection.Vertical?"left":"top"]=this.placeholderPosition.value,e);return React.createElement("div",{className:"vss-Splitter--drag-placeholder",style:t})}return null},t.prototype._handleDragEvent=function(e,t,i){var n=this.props.fixedElement;e.preventDefault(),e.stopPropagation();var o=this._getEventBoundedClientPos(t,i),r=this._getNewFixedSize(this._previousFixedSize,o-this._dragAnchorPos),s=r.collapsed?0:r.fixedSize,a=n===SplitterElementPosition.Near?s:this._getElementSize(this._splitterContainer)-s-DIVIDER_WIDTH;a!==this.placeholderPosition.value&&(this.placeholderPosition.value=a)},t.prototype._setFixedSize=function(e){var t=this.props.onFixedSizeChanged;if(e.collapsed)this.collapse();else{var i=e.fixedSize;this.uncontrolledFixedSize.value=i,t&&t(i),this.isCollapsed()&&this.expand()}},t.prototype._moveDivider=function(e){var t=this._getElementSize(this._fixedRef),i=this._getNewFixedSize(t,e);this._setFixedSize(i),this._fireWindowResize()},t.prototype._attachMouseWindowEvents=function(){this.events.addEventListener(window,"mousemove",this._onDividerMouseMove),this.events.addEventListener(window,"mouseup",this._onDividerMouseUp)},t.prototype._detachMouseWindowEvents=function(){this.events.removeEventListener(window,"mousemove",this._onDividerMouseMove),this.events.removeEventListener(window,"mouseup",this._onDividerMouseUp)},t.prototype._attachTouchWindowEvents=function(){this.events.addEventListener(window,"touchmove",this._onDividerTouchMove),this.events.addEventListener(window,"touchend",this._onDividerTouchEnd)},t.prototype._detachTouchWindowEvents=function(){this.events.removeEventListener(window,"touchmove",this._onDividerTouchMove),this.events.removeEventListener(window,"touchend",this._onDividerTouchEnd)},t.prototype._getEventBoundedClientPos=function(e,t){var i;switch(this.props.splitterDirection){case SplitterDirection.Vertical:i=e;break;case SplitterDirection.Horizontal:i=t;break;default:i=0}return this._getBoundedClientPos(i)},t.prototype._getBoundedClientPos=function(e){var t=this._getSplitterBoundaries(!!this.props.onCollapsedChanged),i=t.startBound,n=t.endBound;return Math.max(i,Math.min(e,n))-this._getElementStartPos(this._splitterContainer)},t.prototype._getSplitterBoundaries=function(e){void 0===e&&(e=!1);var t=this.props,i=t.fixedElement,n=t.minFixedSize,o=t.maxFixedSize;if(!this._splitterContainer)return{startBound:0,endBound:0};e&&(n=0);var r=this._getElementStartPos(this._splitterContainer),s=r+this._getElementSize(this._splitterContainer);return{startBound:i===SplitterElementPosition.Near?n?r+n:r:o?s-o:r,endBound:i===SplitterElementPosition.Near?o?r+o:s:n?s-n:s}},t.prototype._getNewFixedSize=function(e,t){var i=this.props,n=i.fixedElement,o=i.maxFixedSize,r=i.minFixedSize,s=void 0===r?0:r,a=i.onCollapsedChanged;void 0===o&&(o=this._getElementSize(this._splitterContainer));var l=t;n===SplitterElementPosition.Far&&(l*=-1);var d=e+l;d>o&&(d=o);var p=this.isCollapsed();return a&&(p=d<COLLAPSED_PANE_SIZE||!this.isCollapsed()&&d<s),d<s&&(d=s),{fixedSize:d,collapsed:p}},t.prototype.isCollapsed=function(){return!!ObservableLike.getValue(this.props.collapsed)},t.prototype._isDragging=function(){return void 0!==this.placeholderPosition.value},t.prototype._getElementSize=function(e){return this.props.splitterDirection===SplitterDirection.Vertical?e.clientWidth:e.clientHeight},t.prototype._getElementStartPos=function(e){var t=e.getBoundingClientRect();return this.props.splitterDirection===SplitterDirection.Vertical?t.left:t.top},t.prototype._fireWindowResize=function(){var e=document.createEvent("Event");e.initEvent("resize",!1,!0),window.dispatchEvent(e)},t.defaultProps={fixedElement:SplitterElementPosition.Far,splitterDirection:SplitterDirection.Vertical},t}(React.Component);export{Splitter};