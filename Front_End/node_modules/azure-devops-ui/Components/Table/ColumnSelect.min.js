import"../../CommonImports";import"../../Core/core.css";import"./Table.css";import*as React from"react";import{ObservableValue}from"../../Core/Observable";import{announce}from"../../Core/Util/Accessibility";import{Checkbox,TriStateCheckbox}from"../../Checkbox";import{Observer}from"../../Observer";import*as Resources from"../../Resources.Widgets";import{css,KeyCode,preventDefault}from"../../Util";import{IMeasurementStyle,TableColumnLayout}from"./Table.Props";var ColumnSelect=function(){function e(){var e=this;this.columnSelectBehavior={initialize:function(t){e.ariaHidden="menu"===t.tableProps.role,e.itemProvider=t.tableProps.itemProvider,e.selection=t.tableProps.selection,e.onSelect=t.tableProps.onSelect},componentDidMount:function(t){e.componentDidMount(t)},componentDidUpdate:function(t){e.componentDidUpdate(t)},componentWillUnmount:function(){e.componentWillUnmount()}},this.allSelected=new ObservableValue(!1),this.columnLayout=TableColumnLayout.none,this.id="_select",this.width=2.5,this.widthStyle=IMeasurementStyle.REM,this.behaviors=[this.columnSelectBehavior],this.renderCell=function(t,o,i){var n=e.selection,l=n&&n.selected(t),r=n&&n.selectable(t);return React.createElement("td",{"aria-colindex":o+1,"aria-hidden":e.ariaHidden,className:css("bolt-table-cell-select bolt-table-cell bolt-list-cell","col-"+o),"data-column-index":o,key:"col-select",onClick:preventDefault,onDoubleClick:preventDefault,onMouseDown:function(o){e.updateSelection(o,t),o.preventDefault()},onKeyDown:function(o){o.which===KeyCode.space&&(e.updateSelection(o,t),o.preventDefault())}},React.createElement("div",{className:"flex-row justify-center"},React.createElement("span",{className:"flex-row-inline"},React.createElement(Checkbox,{ariaLabel:Resources.SelectRowLabel,checked:!!l,excludeTabStop:!0,disabled:!r}))))},this.renderHeaderCell=function(t,o,i){return React.createElement("th",{"aria-colindex":t+1,className:css("bolt-table-cell-select bolt-table-header-cell","col-header-"+t),"data-column-index":t,key:"col-select"},React.createElement("div",{className:"flex-row"},React.createElement(Observer,{allSelected:e.allSelected},function(t){var o=e,n=o.itemProvider,l=o.selection,r=n&&n.length;return React.createElement("div",{className:"flex-row flex-grow justify-center"},l&&l.multiSelect&&-1!==r&&React.createElement(TriStateCheckbox,{ariaLabel:Resources.SelectAllRowsLabel,checked:t.allSelected,focuszoneId:i,onChange:e.onChangeHeader}))})))},this.onChangeHeader=function(t){var o=e,i=o.itemProvider,n=o.onSelect,l=o.selection;if(l&&(!1!==e.allSelected.value?(l.clear(),announce(Resources.AllRowsUnselectedMessage,!0)):(l.select(0,i&&i.length),announce(Resources.AllRowsSelectedMessage,!0))),n&&i)for(var r=0;r<i.length;r++)n(t,e.getListRow(r))},this.onSelectionChange=function(){var t=e,o=t.itemProvider,i=t.selection;if(i){var n=i.selectedCount,l=o&&o.length-i.unselectableCount;e.allSelected.value=n>0&&(n===l||void 0)}},this.updateSelection=function(t,o){var i=e,n=i.onSelect,l=i.selection;if(l&&(l.selected(o)?l.unselect(o):l.select(o,1,!0)),n){n(t,e.getListRow(o))}},this.getListRow=function(t){return{data:e.itemProvider?e.itemProvider.value[t]:{},index:t}}}return e.prototype.componentDidMount=function(e){var t=this.itemProvider,o=this.selection;o&&(o.subscribe(this.onSelectionChange),this.onSelectionChange()),t&&t.subscribe&&t.subscribe(this.onSelectionChange)},e.prototype.componentDidUpdate=function(e){var t=this.selection;t!==e.tableProps.selection&&(t&&t.unsubscribe(this.onSelectionChange),t=e.tableProps.selection,this.selection=t,t&&t.subscribe(this.onSelectionChange)),t&&this.onSelectionChange(),this.itemProvider!==e.tableProps.itemProvider&&(this.itemProvider&&this.itemProvider.unsubscribe&&this.itemProvider.unsubscribe(this.onSelectionChange),this.itemProvider=e.tableProps.itemProvider,this.itemProvider&&this.itemProvider.subscribe&&this.itemProvider.subscribe(this.onSelectionChange))},e.prototype.componentWillUnmount=function(){var e=this.selection;e&&e.unsubscribe(this.onSelectionChange),this.itemProvider&&this.itemProvider.unsubscribe&&this.itemProvider.unsubscribe(this.onSelectionChange)},e}();export{ColumnSelect};