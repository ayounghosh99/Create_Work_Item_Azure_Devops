function getVisibleColumnsAndIndices(e){return e.map(function(e,t){return{column:e,originalIndex:t}}).filter(function(e){var t=e.column;return ObservableLike.getValue(t.width)})}function getActionableIndex(e){return e.findIndex(function(e){return 0!==ObservableLike.getValue(e.width)&&(e.behaviors&&e.behaviors.length>0||!!e.sortProps)})}function getVariableLength(){return 80*Math.random()+20+"%"}import{__assign,__extends,__spreadArrays}from"tslib";import"../../CommonImports";import"../../Core/core.css";import"./Table.css";import*as React from"react";import{ObservableLike}from"../../Core/Observable";import*as Utils_Accessibility from"../../Core/Util/Accessibility";import{format}from"../../Core/Util/String";import{FocusOrMouseWithin}from"../../FocusOrMouseWithin";import{FocusWithin}from"../../FocusWithin";import{FocusZone,FocusZoneContext,FocusZoneDirection,FocusZoneKeyStroke}from"../../FocusZone";import{Icon}from"../../Icon";import{Intersection}from"../../Intersection";import{getDefaultLinkProps}from"../../Link";import{List,renderListCell}from"../../List";import{Observer}from"../../Observer";import*as Resources from"../../Resources.Widgets";import{Orientation,Position,Sizer}from"../../Sizer";import{Tooltip}from"../../TooltipEx";import{css,getSafeId,KeyCode}from"../../Util";import{EventDispatch}from"../../Utilities/Dispatch";import{getTabIndex}from"../../Utilities/Focus";import{ScreenSizeConditional}from"../../Utilities/ScreenSize";import{ColumnJustification,IMeasurementStyle,SortOrder,TableColumnLayout,TableColumnStyle}from"./Table.Props";import{TableBreakpoint}from"./TableBreakpoint";export var ColumnFill={columnLayout:TableColumnLayout.none,id:"_fill",renderCell:function(e,t){return React.createElement("td",{key:"col-fill","aria-colindex":t+1,"aria-hidden":!0,className:css("bolt-table-cell bolt-list-cell","col-"+t),"data-column-index":t,role:"presentation"})},renderHeaderCell:function(e,t){return React.createElement("th",{key:"col-fill","aria-hidden":!0,className:css(t.headerClassName,"bolt-table-header-cell bolt-table-header-cell-empty","col-header-"+e),"data-column-index":e,role:"presentation"})},width:-100};var Table=function(e){function t(t){var n=e.call(this,t)||this;n.list=React.createRef(),n.onBreakpoint=function(){var e=n.props.tableBreakpoints?getVisibleColumnsAndIndices(n.props.columns).map(function(e){return e.originalIndex}).join(","):"";(n.state.renderInvisible||n.state.visibleColumnsKey!==e)&&n.setState({renderInvisible:!1,visibleColumnsKey:e})},n.onColumnsChanged=function(){return n.forceUpdate(),!1},n.renderHeader=function(){for(var e=n.props,t=e.columns,o=e.showHeader,r=e.renderHeader,a=e.spacerWidth,l=[],i=0,s=0;s<t.length;s++){(c=ObservableLike.getValue(t[s].width))<0&&(i+=c)}for(s=0;s<t.length;s++){var c=ObservableLike.getValue(t[s].width);l[s]=c>=0?c:-c/i*100}var d=null;return!1!==o&&(d=r?r(t):React.createElement(TableHeader,{tableColumns:t})),"function"==typeof o&&(d=React.createElement(ScreenSizeConditional,{condition:function(e){return o(e)}},d)),React.createElement(React.Fragment,null,React.createElement("colgroup",null,React.createElement("col",{"aria-hidden":"true",key:"col-group-left-spacer",style:{width:0===a?a+"%":a+"px"}}),getVisibleColumnsAndIndices(t).map(function(e){var t=e.column,o=e.originalIndex,r=t.widthStyle,a=void 0===r?IMeasurementStyle.Pixel:r;return React.createElement(Observer,{key:"col-group-"+o,width:{filter:n.onColumnsChanged,observableValue:t.width}},function(){return React.createElement("col",{style:{width:Math.abs(l[o])+(l[o]<0?"%":a===IMeasurementStyle.Pixel?"px":"rem")}})})}),React.createElement("col",{"aria-hidden":"true",key:"col-group-right-spacer",style:{width:0===a?a+"%":a+"px"}})),d)},n.renderLoadingRow=function(e,t){var o,r=n.props,a=r.columns,l=r.renderLoadingRow,i={ariaBusy:!0,ariaRowOffset:t.ariaRowOffset,data:t.data,eventDispatch:n.state.eventDispatch,excludeFocusZone:!0,excludeTabStop:null!==(o=n.props.excludeTabStop)&&void 0!==o?o:t.excludeTabStop,itemProvider:n.props.itemProvider,listProps:t.listProps,onFocusItem:t.onFocusItem,renderSpacer:n.props.renderSpacer,selection:n.props.selection,singleClickActivation:n.props.onActivate&&n.props.singleClickActivation};return l?l(e,i):React.createElement(TableLoadingRow,{columns:a,details:i,rowIndex:e})},n.renderRow=function(e,t,o){var r,a={selectableText:o.selectableText,ariaRowOffset:o.ariaRowOffset,eventDispatch:n.state.eventDispatch,data:o.data,excludeTabStop:null!==(r=n.props.excludeTabStop)&&void 0!==r?r:o.excludeTabStop,itemProvider:n.props.itemProvider,listProps:o.listProps,onFocusItem:o.onFocusItem,renderSpacer:n.props.renderSpacer,selection:n.props.selection,singleClickActivation:n.props.onActivate&&n.props.singleClickActivation},l=t.renderRow||n.props.renderRow;return l?l(e,t,a):React.createElement(TableRow,{details:a,index:e,linkProps:t.linkProps},renderColumns(e,n.props.columns,t,a))},n.state={columnBehaviors:[],eventDispatch:t.eventDispatch||new EventDispatch,renderInvisible:!!t.tableBreakpoints,visibleColumnsKey:"",tableBehaviors:[],tableWidth:""};for(var o=0;o<t.columns.length;o++){var r=t.columns[o];if(r.behaviors)for(var a=0,l=r.behaviors;a<l.length;a++){(c=l[a])&&c.initialize&&c.initialize({tableProps:t,columnIndex:o},{},n.state.eventDispatch)}}if(t.behaviors)for(var i=0,s=t.behaviors;i<s.length;i++){var c=s[i];c.initialize&&c.initialize(t,n,n.state.eventDispatch)}return n}return __extends(t,e),t.getDerivedStateFromProps=function(e,t){for(var n=[],o=[],r=0;r<e.columns.length;r++){var a=e.columns[r];if(a.behaviors)for(var l=0,i=a.behaviors;l<i.length;l++){var s=i[l];o.push(s)}}return e.behaviors&&n.splice.apply(n,__spreadArrays([n.length,0],e.behaviors)),{columnBehaviors:o,tableBehaviors:n}},t.prototype.render=function(){for(var e=this.state,t=e.eventDispatch,n=e.renderInvisible,o=e.visibleColumnsKey,r=this.props,a=r.selectableText,l=r.className,i=r.columns,s=r.containerClassName,c=r.enforceSingleSelect,d=r.focuszoneProps,u=r.showLines,m=r.id,p=r.itemProvider,b=r.maxHeight,h=r.onActivate,f=r.onFocus,v=r.onSelect,R=r.pageSize,g=r.role,x=r.rowHeight,C=r.scrollable,y=r.selection,w=r.singleClickActivation,S=r.selectRowOnClick,I=r.tableBreakpoints,E=r.virtualize,k=[],L=2*(this.props.spacerWidth||0),T=L,N=L,P=L,z=!1,F=!1,O=!1,A=0,D=0,_=0,W=i;_<W.length;_++){var B=W[_],H=B.maxWidth,U=B.minWidth,M=B.widthStyle,V=void 0===M?IMeasurementStyle.Pixel:M,Z=ObservableLike.getValue(B.width);k.push(B.width),Z<0?(O=!0,N+=U||0,H?(z=!0,T+=H):F=!0,A++):Z>0&&(V===IMeasurementStyle.Pixel?(P+=Z,N+=Z,T+=Z):(P+=16*Z,N+=16*Z,T+=16*Z),A++),"_fill"===B.id&&D++}var j={selectableText:a,ariaColumnCount:A-D,ariaLabel:this.props.ariaLabel,ariaRowOffset:this.props.showHeader?1:0,className:css(l,"bolt-table",u&&"bolt-table-show-lines"),columnCount:A+2,enforceSingleSelect:c,eventDispatch:t,focuszoneProps:d,id:m,itemProvider:p,maxWidth:z&&!F?T+"px":void 0,maxHeight:b,minWidth:N!==P?N+"px":void 0,onActivate:h,onFocus:f,onSelect:v,pageSize:R,renderHeader:this.renderHeader,renderLoadingRow:this.renderLoadingRow,renderRow:this.renderRow,role:g,rowHeight:x,selection:y,selectRowOnClick:S,singleClickActivation:w,virtualize:E,width:O?"100%":P+"px"};getActionableIndex(i)>=0&&(j.defaultTabbableRow=-1);var K=React.createElement("div",{className:css(s,"bolt-table-container flex-grow",n&&"invisible",C&&"v-scroll-auto",I&&"h-scroll-hidden")},I?React.createElement(TableBreakpoint,{columnWidths:k,onBreakpoint:this.onBreakpoint,breakpoints:I}):void 0,React.createElement(List,__assign({},j,{key:o,ref:this.list})));return C&&(K=React.createElement(Intersection,null,K)),K},t.prototype.componentDidMount=function(){for(var e=0,t=this.state.tableBehaviors;e<t.length;e++){(r=t[e]).componentDidMount&&r.componentDidMount(this.props)}for(var n=0,o=this.state.columnBehaviors;n<o.length;n++){var r=o[n];r.componentDidMount&&r.componentDidMount({tableProps:this.props})}},t.prototype.componentDidUpdate=function(){for(var e=0,t=this.state.tableBehaviors;e<t.length;e++){(r=t[e]).componentDidUpdate&&r.componentDidUpdate(this.props)}for(var n=0,o=this.state.columnBehaviors;n<o.length;n++){var r=o[n];r.componentDidUpdate&&r.componentDidUpdate({tableProps:this.props})}},t.prototype.componentWillUnmount=function(){for(var e=0,t=this.state.tableBehaviors;e<t.length;e++){(r=t[e]).componentWillUnmount&&r.componentWillUnmount()}for(var n=0,o=this.state.columnBehaviors;n<o.length;n++){var r=o[n];r.componentDidUpdate&&r.componentDidUpdate({tableProps:this.props})}},t.prototype.addOverlay=function(e,t,n,o){if(void 0===o&&(o=0),this.list.current)return this.list.current.addOverlay(e,t,n,o)},t.prototype.removeOverlay=function(e){if(this.list.current)return this.list.current.removeOverlay(e)},t.prototype.focusRow=function(e,t){return void 0===t&&(t=1),this.list.current?this.list.current.focusRow(e,t):Promise.resolve()},t.prototype.getFocusIndex=function(){return this.list.current?this.list.current.getFocusIndex():-1},t.prototype.getStats=function(){return this.list.current?this.list.current.getStats():{firstMaterialized:-1,firstRendered:-1,lastMaterialized:-1,lastRendered:-1}},t.prototype.scrollIntoView=function(e,t){if(this.list.current)return this.list.current.scrollIntoView(e,t)},t.defaultProps={role:"grid",selectRowOnClick:!0,showHeader:!0,showLines:!0,singleClickActivation:!0,spacerWidth:8},t}(React.Component);export{Table};export function renderColumns(e,t,n,o){return getVisibleColumnsAndIndices(t).map(function(t,r){var a=t.column;return a.renderCell(e,r,a,n,e+(o.ariaRowOffset?o.ariaRowOffset:1))})};var TableHeader=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.render=function(){var e=this,t=getActionableIndex(this.props.tableColumns);return React.createElement(FocusZoneContext.Consumer,null,function(n){return React.createElement(FocusZone,{direction:FocusZoneDirection.Horizontal},React.createElement("thead",null,React.createElement(FocusWithin,null,function(o){return React.createElement("tr",{"aria-rowindex":1,className:css("bolt-table-header-row",o.hasFocus&&"focused"),"data-row-index":-1,onBlur:o.onBlur,onFocus:o.onFocus},React.createElement("th",{"aria-hidden":"true",key:"left-spacer",role:"presentation",className:"bolt-table-header-border"}),getVisibleColumnsAndIndices(e.props.tableColumns).map(function(e,o){var r=e.column,a=e.originalIndex;return r.renderHeaderCell?r.renderHeaderCell(o,r,n.focuszoneId,a===t):r.iconProps||r.name?React.createElement(TableHeaderCell,{key:"col-header-"+o,column:r,columnIndex:o,focuszoneId:n.focuszoneId,isFirstActionableHeader:a===t},React.createElement(Tooltip,{overflowOnly:!0,text:r.name},React.createElement("div",{className:"bolt-table-header-cell-text text-ellipsis body-s"},r.iconProps&&Icon(r.iconProps),React.createElement("span",null,r.name)))):React.createElement("th",{"aria-colindex":o+1,"aria-label":r.ariaLabel||Resources.EmptyColumnHeaderLabel,"aria-readonly":"true",className:"bolt-table-header-border",key:"col-header-"+o})}),React.createElement("th",{"aria-hidden":"true",key:"right-spacer",role:"presentation",className:"bolt-table-header-border"}))})))})},t}(React.Component),boltTableHeaderCellCount=0,TableHeaderCell=function(e){function t(t){var n=e.call(this,t)||this;return n.element=React.createRef(),n.state={measuredWidth:0},n.onSize=function(e,t){var o=n.props.column;o.onSize&&o.onSize(e,n.props.columnIndex,t,o)},n.headerCellId=boltTableHeaderCellCount++,n}return __extends(t,e),t.prototype.render=function(){var e,t=this,n=this.props,o=n.column,r=n.columnIndex,a=n.focuszoneId,l=n.isFirstActionableHeader;return o.onSize&&(e=React.createElement(Observer,{width:o.width},function(e){var n=e.width;return n<0&&(n=t.state.measuredWidth),React.createElement(Sizer,{ariaLabel:format(Resources.ColumnSizerLabel,o.name),className:"bolt-table-header-sizer",divider:!1,maxSize:o.maxWidth,minSize:o.minWidth,onSize:t.onSize,onSizeEnd:t.props.column.onSizeEnd,orientation:Orientation.row,position:Position.near,size:n,tabIndex:0})})),React.createElement(FocusZoneContext.Consumer,null,function(n){var i,s=o.behaviors&&o.behaviors.length>0||!!o.sortProps,c=o.sortProps,d=void 0===c?{}:c,u=o.sortProps&&void 0!==d.sortOrder?Icon({className:"bolt-table-header-sort-icon body-s",iconName:d.sortOrder===SortOrder.ascending?"SortUp":"SortDown"}):null;o.justification===ColumnJustification.Left?i="justify-start":o.justification===ColumnJustification.Right&&(i="justify-end");var m=r+1,p=getSafeId("th-col-content-"+t.headerCellId);return React.createElement("th",{role:"columnheader","aria-colindex":m,"aria-labelledby":p,"aria-readonly":"true","aria-sort":void 0!==d.sortOrder?d.sortOrder===SortOrder.ascending?"ascending":"descending":void 0,className:css(o.headerClassName,"bolt-table-header-cell","col-header-"+r,s&&"bolt-table-header-cell-actionable"),"data-column-index":r,"data-focuszone":s&&css(l&&a,n.focuszoneId),ref:t.element,tabIndex:s&&l?0:-1},React.createElement("div",{className:css("bolt-table-header-cell-content flex-row",i)},e,o.justification===ColumnJustification.Right&&u,React.createElement("div",{id:p,className:"scroll-hidden"},t.props.children),o.justification!==ColumnJustification.Right&&u))})},t.prototype.componentDidMount=function(){this.updateMeasuredWidth()},t.prototype.componentDidUpdate=function(){this.updateMeasuredWidth()},t.prototype.updateMeasuredWidth=function(){var e=this.props.column;if(e.onSize&&this.element.current&&ObservableLike.getValue(e.width)<0){var t=this.element.current.getBoundingClientRect().width;t!==this.state.measuredWidth&&this.setState({measuredWidth:t})}},t}(React.Component);export{TableHeaderCell};export function TableRow(e){var t,n,o=function(e){var t=e.target.nodeName;return e.defaultPrevented||"INPUT"===t||"TEXTAREA"===t||e.which===KeyCode.leftArrow&&r.current&&(r.current.focus(),e.preventDefault()),FocusZoneKeyStroke.IgnoreNone},r=React.useState(function(){return React.createRef()})[0],a=e.details,l=e.index,i=e.linkProps,s=a.selectableText,c=a.ariaLabel,d=a.ariaBusy,u=a.ariaDescribedBy,m=a.ariaPosInSet,p=a.ariaRowOffset,b=a.ariaSetSize,h=a.excludeFocusZone,f=a.id,v=a.renderSpacer,R=a.role,g=a.selection,x=a.singleClickActivation;"menuitemcheckbox"===R?t=g&&g.selected(l):n=g&&g.selected(l);var C=React.createElement(FocusOrMouseWithin,{onFocus:function(t){var n;e.details.onFocusItem(e.index,t);var o=null!==(n=e.details.ariaPosInSet)&&void 0!==n?n:e.index+p;e.details.ariaSetSize?e.linkProps?Utils_Accessibility.announce(format(Resources.ClickableRowAnnouncementWithSize,o),!0):"option"==R?Utils_Accessibility.announce(Resources.ListItem,!0):Utils_Accessibility.announce(format(Resources.RowAnnouncementWithSize,o,e.details.ariaSetSize),!0):e.linkProps?Utils_Accessibility.announce(format(Resources.ClickableRowAnnouncement,o),!0):Utils_Accessibility.announce(format(Resources.RowAnnouncement,o),!0)}},function(C){return React.createElement(FocusZoneContext.Consumer,null,function(y){var w={"aria-busy":d,"aria-checked":t,"aria-describedby":u,"aria-label":c,"aria-rowindex":"menuitemcheckbox"===R||"option"===R?void 0:l+p,"aria-posinset":null===m?void 0:m,"aria-selected":n,"aria-setsize":null===b?void 0:b,className:css(e.className,"bolt-table-row bolt-list-row",0===l&&"first-row",C.hasFocus&&"focused",g&&g.selected(l)&&"selected",x&&"single-click-activation",i&&"v-align-middle",s&&"selectable-text"),"data-focuszone":h||g&&!g.selectable(l)?void 0:y.focuszoneId,"data-row-index":e.index,id:getSafeId(f),role:R||"row",tabIndex:getTabIndex(a),onBlur:C.onBlur,onFocus:C.onFocus,onMouseEnter:C.onMouseEnter,onMouseLeave:C.onMouseLeave,ref:r},S=[React.createElement("td",{"aria-hidden":"true",key:"left-spacer",className:"bolt-table-cell-compact bolt-table-cell bolt-list-cell bolt-table-spacer-cell",role:"presentation"},v&&v(l,!0)),e.children,React.createElement("td",{"aria-hidden":"true",key:"right-spacer",className:"bolt-table-cell-compact bolt-table-cell bolt-list-cell bolt-table-spacer-cell",role:"presentation"},v&&v(l,!1))];return React.createElement(FocusZone,{direction:FocusZoneDirection.Horizontal,postprocessKeyStroke:o},i?React.createElement("a",__assign({},getDefaultLinkProps(i),w),S):React.createElement("tr",__assign({},w),S))})});return a.tooltipProps?React.createElement(Tooltip,__assign({},a.tooltipProps),C):C};export function TableLoadingRow(e){return React.createElement(TableRow,{className:"bolt-list-row-loading",details:e.details,index:e.rowIndex},getVisibleColumnsAndIndices(e.columns).map(function(e,t){return SimpleTableCell({columnIndex:t,children:renderLoadingCell(e.column.columnLayout)})}))};export function TableCell(e){var t,n=e.ariaLabel,o=e.ariaRowIndex,r=e.className,a=e.colspan,l=e.columnIndex,i=e.tableColumn;return i&&(i.justification===ColumnJustification.Left?t="justify-cell-start":i.justification===ColumnJustification.Right&&(t="justify-cell-end")),React.createElement("td",{"aria-colindex":l+1,"aria-label":n,"aria-readonly":i&&i.readonly,"aria-rowindex":o,className:css(r,i&&i.className,"bolt-table-cell bolt-list-cell",t),colSpan:a,"data-column-index":l,key:"col-"+l,role:"gridcell"},e.children)};export function SimpleTableCell(e){var t=React.createElement("div",{className:css(e.contentClassName,"bolt-table-cell-content flex-row flex-center")},e.children);return TableCell({ariaLabel:e.ariaLabel,ariaRowIndex:e.ariaRowIndex,children:t,className:e.className,colspan:e.colspan,columnIndex:e.columnIndex,tableColumn:e.tableColumn})};export function TwoLineTableCell(e){var t,n="bolt-table-two-line-cell-item flex-row scroll-hidden",o=React.createElement("div",{className:n},e.line1),r=React.createElement("div",{className:n},e.line2),a=React.createElement(React.Fragment,null,o,r);return t=e.iconProps?React.createElement("div",{className:css(e.className,"bolt-table-cell-content flex-row flex-center")},Icon(__assign(__assign({},e.iconProps),{className:css(e.iconProps.className,"bolt-table-two-line-cell-icon flex-noshrink")})),React.createElement("div",{className:"flex-column scroll-hidden"},a)):React.createElement("div",{className:css(e.className,"bolt-table-cell-content flex-column")},a),TableCell({ariaRowIndex:e.ariaRowIndex,children:t,colspan:e.colspan,columnIndex:e.columnIndex,className:"bolt-table-two-line-cell",tableColumn:e.tableColumn})};export function renderEmptyCell(e,t){return React.createElement(TableCell,{columnIndex:t,key:t})};export function renderSimpleCell(e,t,n,o,r){return renderSimpleCellValue(t,n,o[n.id],r)};export function renderSimpleCellValue(e,t,n,o){var r=t.columnStyle,a=!(!n||"string"==typeof n||"number"==typeof n||!n.href);return React.createElement(SimpleTableCell,{ariaRowIndex:o,className:css(r===TableColumnStyle.Primary&&"bolt-table-cell-primary",r===TableColumnStyle.Secondary&&"bolt-table-cell-secondary",r===TableColumnStyle.Tertiary&&"bolt-table-cell-tertiary"),columnIndex:e,contentClassName:a?"bolt-table-cell-content-with-link":void 0,key:e,tableColumn:t},n&&renderListCell(n))};export function renderLoadingCell(e){return e===TableColumnLayout.singleLine||void 0===e?React.createElement("div",{className:"shimmer shimmer-line",style:{width:getVariableLength()}}," "):e===TableColumnLayout.singleLinePrefix?React.createElement(React.Fragment,null,React.createElement("div",{className:"shimmer shimmer-circle-small flex-noshrink"}),React.createElement("div",{className:"shimmer shimmer-line",style:{width:getVariableLength()}}," ")):e===TableColumnLayout.twoLine?React.createElement("div",{className:"flex-column flex-grow"},React.createElement("div",{className:"bolt-table-two-line-cell-item shimmer shimmer-line",style:{width:getVariableLength()}}," "),React.createElement("div",{className:"bolt-table-two-line-cell-item shimmer shimmer-line",style:{width:getVariableLength()}}," ")):e===TableColumnLayout.twoLinePrefix?React.createElement(React.Fragment,null,React.createElement("div",{className:"shimmer shimmer-circle-large flex-noshrink"}),React.createElement("div",{className:"flex-column flex-grow"},React.createElement("div",{className:"bolt-table-two-line-cell-item shimmer shimmer-line",style:{width:getVariableLength()}}," "),React.createElement("div",{className:"bolt-table-two-line-cell-item shimmer shimmer-line",style:{width:getVariableLength()}}," "))):null};