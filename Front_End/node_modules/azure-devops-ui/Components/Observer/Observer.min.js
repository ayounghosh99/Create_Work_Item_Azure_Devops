function getObservableValue(e){return e&&void 0!==e.observableValue?e.observableValue:e}function getPropValue(e){return ObservableLike.getValue(getObservableValue(e))}function updateSubscriptionsAndState(e,t,s,r){var i=__assign({},s),n=!1;if(e)for(var o in e){(a=getObservableValue(e[o]))!==(u=getObservableValue(t[o]))&&(r&&r.unsubscribe(o,e),void 0===u&&(delete i.values[o],n=!0))}for(var o in t){var a=e&&getObservableValue(e[o]),u=getObservableValue(t[o]);a!==u&&(r&&r.subscribe(o,t),s.values[o]!==getPropValue(u)&&(i.values[o]=getPropValue(u),n=!0))}return n?i:null}import{__assign,__extends}from"tslib";import"../../CommonImports";import"../../Core/core.css";import*as React from"react";import{ObservableLike}from"../../Core/Observable";var Observer=function(e){function t(t){var s=e.call(this,t)||this;s.subscriptions={};var r={values:{},oldProps:{}};for(var i in t)r.values[i]=getPropValue(t[i]);return s.state=r,s}return __extends(t,e),t.getDerivedStateFromProps=function(e,t){var s=updateSubscriptionsAndState(t.oldProps,e,t);return null!=s?__assign(__assign({},s),{oldProps:e}):{oldProps:e}},t.prototype.render=function(){var e={};for(var t in this.state.values)"children"!==t&&(e[t]=this.state.values[t]);if("function"==typeof this.props.children){return(s=this.props.children)(e)}var s=React.Children.only(this.props.children);return React.cloneElement(s,__assign(__assign({},s.props),e),s.props.children)},t.prototype.componentDidMount=function(){this.updateSubscriptionsAndStateAfterRender()},t.prototype.componentDidUpdate=function(){this.updateSubscriptionsAndStateAfterRender(),this.props.onUpdate&&this.props.onUpdate()},t.prototype.componentWillUnmount=function(){for(var e in this.subscribedProps)this.unsubscribe(e,this.subscribedProps)},t.prototype.subscribe=function(e,t){if("children"!==e){var s=void 0,r=t[e],i=void 0;if(r&&void 0!==r.observableValue&&(r=(s=r).observableValue,i=s.action),ObservableLike.isObservable(r)){var n=this.onValueChanged.bind(this,e,r,s);ObservableLike.subscribe(r,n,i),this.subscriptions[e]={delegate:n,action:i}}}},t.prototype.unsubscribe=function(e,t){if("children"!==e){var s=getObservableValue(t[e]);if(ObservableLike.isObservable(s)){var r=this.subscriptions[e];ObservableLike.unsubscribe(s,r.delegate,r.action),delete this.subscriptions[e]}}},t.prototype.updateSubscriptionsAndStateAfterRender=function(){var e=updateSubscriptionsAndState(this.subscribedProps,this.props,this.state,this);null!=e&&this.setState(e),this.subscribedProps=__assign({},this.props)},t.prototype.onValueChanged=function(e,t,s,r,i){var n=!0;e in this.subscriptions&&(s&&s.filter&&(n=s.filter(r,i)),n&&this.setState(function(s,i){var n;return{values:__assign(__assign({},s.values),(n={},n[e]=t.value||r,n))}}))},t}(React.Component);export{Observer};