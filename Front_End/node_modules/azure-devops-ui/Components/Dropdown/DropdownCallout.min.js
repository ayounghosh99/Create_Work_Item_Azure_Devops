import{__assign,__extends}from"tslib";import"../../CommonImports";import"../../Core/core.css";import"./Dropdown.css";import*as React from"react";import{ObservableLike}from"../../Core/Observable";import{format}from"../../Core/Util/String";import{Button}from"../../Button";import{Callout,ContentSize}from"../../Callout";import{FocusZone,FocusZoneDirection,FocusZoneKeyStroke}from"../../FocusZone";import{IconSize}from"../../Icon";import{ListBox}from"../../ListBox";import{Observer}from"../../Observer";import*as Resources from"../../Resources.Dropdown";import{TextField}from"../../TextField";import{css,getSafeIdSelector,KeyCode,preventDefault}from"../../Util";var ItemsForFilter=10,DefaultWidth=256,FilterBarPadding=16,FilterBarIconWidth=27;export function DropdownCallout(e){return React.createElement(DropdownCalloutComponent,__assign({},e))};var DropdownCalloutComponent=function(e){function t(t){var o=e.call(this,t)||this;return o.callout=React.createRef(),o.calloutContent=React.createRef(),o.filterBox=React.createRef(),o.initFocusElement=React.createRef(),o.updateLayout=function(){return setTimeout(function(){o.callout.current&&o.callout.current.updateLayout()},0),!0},o.onMouseDown=function(e){o.props.ignoreMouseDown&&"INPUT"!==e.target.tagName&&preventDefault(e)},o.listBoxDidUpdate=function(){o.getScrollWidth()},o.getScrollWidth=function(){window.requestAnimationFrame(function(){if(o.calloutContent.current){var e=o.calloutContent.current.offsetWidth-o.props.width;Math.abs(e)>1&&o.setState({scrollBarWidth:e+o.state.scrollBarWidth})}})},o.state={scrollBarWidth:0},o}return __extends(t,e),t.prototype.componentDidMount=function(){this.getScrollWidth()},t.prototype.focus=function(){this.filterBox.current?this.filterBox.current.focus():this.initFocusElement.current&&this.initFocusElement.current.focus()},t.prototype.render=function(){var e=this,t=this.props,o=t.actions,r=t.anchorElement,n=t.anchorOffset,l=t.anchorOrigin,i=t.anchorPoint,a=t.ariaLabel,s=t.blurDismiss,c=void 0===s||s,u=t.calloutContentClassName,d=t.columns,m=t.containerClassName,f=t.contentLocation,p=t.dropdownOrigin,h=t.enforceSingleSelect,b=t.excludeFocusZone,x=t.excludeTabStop,v=t.filteredItems,g=t.filteredNoResultsText,R=t.filteredResultsLoadingText,w=t.filterPlaceholderText,C=t.filterText,F=t.focusOnMount,D=t.getUnselectableRanges,S=t.id,I=t.items,B=t.lightDismiss,E=t.listBoxClassName,N=t.listBoxRef,T=t.loading,y=t.onActivate,L=t.onFilterKeyDown,O=t.onFilterTextChanged,W=t.onSelect,P=t.renderBeforeContent,k=t.renderItem,Z=t.searching,_=t.selection,M=t.showCloseButton,z=t.showFilterBox,K=t.showItemsWhileSearching,U=t.showTree,A=t.title,V=t.updateFilteredItems,q=t.userFilteredItems,j=this.props.width,G=void 0===j?DefaultWidth:j;G>0&&(G-=this.state.scrollBarWidth);var H="bolt-dropdown-textfield-"+S,J=function(){C.value="",O&&O(null,""),V&&V()},Q=function(){e.props.onDismiss&&e.props.onDismiss(),J()};return React.createElement(Callout,{anchorElement:r,anchorOffset:n,anchorOrigin:l,anchorPoint:i,blurDismiss:c,calloutOrigin:p,contentClassName:css(u,"bolt-dropdown flex-column custom-scrollbar v-scroll-auto h-scroll-hidden"),contentLocation:f,contentRef:this.calloutContent,contentShadow:!0,contentSize:ContentSize.Auto,escDismiss:!0,id:S,lightDismiss:B,focuszoneProps:{postprocessKeyStroke:function(e){return e.which!==KeyCode.tab||e.defaultPrevented?FocusZoneKeyStroke.IgnoreNone:(e.preventDefault(),Q(),FocusZoneKeyStroke.IgnoreAll)}},onDismiss:Q,ref:this.callout},React.createElement(FocusZone,{circularNavigation:!0,defaultActiveElement:z||void 0===z&&I.length>ItemsForFilter?getSafeIdSelector(H):".bolt-dropdown-init-focus",direction:FocusZoneDirection.Vertical,focusOnMount:void 0===F||F},React.createElement("div",{className:"bolt-dropdown-container no-outline",onMouseDown:this.onMouseDown,onKeyDown:L,style:{width:G>=0?G:void 0}},React.createElement("div",{"aria-hidden":"true","aria-roledescription":Resources.DropdownCalloutRoleDescription,className:"bolt-dropdown-init-focus no-outline",tabIndex:x?void 0:-1,ref:this.initFocusElement,role:"listbox"}),React.createElement(Observer,{items:{observableValue:I,filter:this.updateLayout}},function(){var t=void 0===z?I.length>ItemsForFilter:z;return t||A||M?React.createElement("div",{className:"bolt-dropdown-header-container"},(A||M)&&React.createElement("div",{className:"bolt-dropdown-header flex-row flex-center"},React.createElement("div",{className:"bolt-dropdown-header-text flex-grow font-weight-semibold"},A),M&&React.createElement(Button,{className:"bolt-dropdown-header-button",ariaLabel:Resources.Close,iconProps:{iconName:"Cancel"},onClick:Q,subtle:!0})),t&&React.createElement("div",{key:"bolt-dropdown-filter-container",className:"bolt-dropdown-filter-container"},React.createElement(Observer,{filterText:C},function(t){return React.createElement(TextField,{key:"bolt-dropdown-filter",ariaLabel:Resources.SearchAriaLabel,className:"bolt-dropdown-filter",excludeTabStop:!0,inputId:H,onChange:O,placeholder:w,prefixIconProps:{iconName:"Search"},ref:e.filterBox,value:C,maxWidth:e.props.width-FilterBarPadding-FilterBarIconWidth,suffixIconProps:t.filterText.length>0?{ariaLabel:Resources.ClearText,iconName:"ChromeClose",onClick:J,size:IconSize.small,tooltipProps:{text:Resources.ClearText}}:void 0})}))):null}),P&&P(),React.createElement(Observer,{filteredItems:v,filteredNoResultsText:g,listBoxItems:{observableValue:I,filter:V},userFilteredItems:{observableValue:q,filter:V}},function(t){var o=null,r="";return(v&&0===v.length||0===I.length)&&!Z&&(r=""===C.value?e.props.noItemsText:format(t.filteredNoResultsText||Resources.NoFilterResults,C.value))&&(o=React.createElement("div",{className:"bolt-dropdown-no-items"},r)),React.createElement(React.Fragment,null,o,React.createElement(ListBox,{ariaLabel:a,className:E,columns:d,containerClassName:css("bolt-dropdown-list-box-container",m),didUpdate:e.listBoxDidUpdate,enforceSingleSelect:h,excludeFocusZone:b,excludeTabStop:!0,searchResultsLoadingText:R,focuszoneProps:null,getUnselectableRanges:D,items:v?v.value:I,loading:T,onActivate:y,onSelect:W,renderItem:k,ref:N,searching:Z,selection:_,showChecksColumn:!0,showItemsWhileSearching:K,showTree:U}))}),React.createElement(Observer,{actions:o},function(t){var o=e.props.actions;return o&&o.length?React.createElement("div",{className:"bolt-actions-container flex-column"},ObservableLike.getValue(o).map(function(e,t){return React.createElement(Button,__assign({key:e.id||t,subtle:!0,excludeTabStop:!0},e))})):null}))))},t.defaultProps={width:DefaultWidth,ignoreMouseDown:!0},t}(React.Component);export{DropdownCalloutComponent};