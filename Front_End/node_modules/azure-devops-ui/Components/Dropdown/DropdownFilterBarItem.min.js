import{__assign,__extends,__spreadArrays}from"tslib";import"../../CommonImports";import"../../Core/core.css";import"./Dropdown.css";import*as React from"react";import{ObservableLike}from"../../Core/Observable";import*as Utils_Accessibility from"../../Core/Util/Accessibility";import{FilterBarItem}from"../../FilterBarItem";import{ListSelection}from"../../List";import{getListBoxItemsValue,wrapListBoxItems}from"../../ListBox";import{Observer,SelectionObserver}from"../../Observer";import*as Resources from"../../Resources.Dropdown";import{css}from"../../Util";import{updateFilterToSelection}from"../../Utilities/DropdownFilter";import{DropdownSelection}from"../../Utilities/DropdownSelection";import{compareSelectionRanges}from"../../Utilities/Selection";import{Dropdown}from"./Dropdown";import{DropdownExpandableButton}from"./DropdownExpandableButton";var DropdownFilterBarItemWidth=256,DropdownFilterBarItem=function(e){function t(t){var r=e.call(this,t)||this;return r.dropdown=React.createRef(),r.componentDidMount=function(){var t;if(e.prototype.componentDidMount.call(r),r.props.filter){var o=null===(t=r.props.filter)||void 0===t?void 0:t.getFilterItemState(r.props.filterItemKey);r.onFilterChanged(o)}},r.selectDefaultFilterItem=function(){if(r.props.filter){var e=r.props.filter.getFilterItemState(r.props.filterItemKey);if(e&&e.value){for(var t=getListBoxItemsValue(r.wrappedItems||r.props.items),o=new ListSelection(r.selection.multiSelect),n=function(r){var n=t.findIndex(function(t){return t.id===e.value[r]||t.data===e.value[r]});n>-1&&o.select(n,1,!0)},i=0;i<e.value.length;i++)n(i);r.selection.value=o.value}}},r.onFilterChanged=function(t){e.prototype.onFilterChanged.call(r,t);var o=getListBoxItemsValue(r.wrappedItems||r.props.items);if(t&&t.value){for(var n=new ListSelection(r.selection.multiSelect),i=function(e){var r=o.findIndex(function(r){return r.id===t.value[e]||r.data===t.value[e]});r>-1&&n.select(r,1,!0)},l=0;l<t.value.length;l++)i(l);compareSelectionRanges(r.selection.value,n.value).length&&(r.selection.value=n.value)}else r.selection.clear()},r.onSelectionChanged=function(e){var t=getListBoxItemsValue(r.wrappedItems||r.props.items);return r.props.filter&&updateFilterToSelection(e,t,r.props.filter,r.props.filterItemKey),!0},r.renderExpandableButton=function(e){var t=r.props,o=t.className,n=t.renderExpandable,i=__assign(__assign({},e),{className:css(o,"bolt-dropdown-filter-bar-item"),subtle:!0,renderSelectedItems:r.renderSelectedItems});return n?n(i):React.createElement(DropdownExpandableButton,__assign({},i))},r.onClearClick=function(){r.selection.clear(),Utils_Accessibility.announce(Resources.AnnounceFilterCleared)},r.renderSelectedItems=function(e,t){var o=t[e.value[0].beginIndex].text||"";e.selectedCount>1&&(o=o+" (+"+(e.selectedCount-1)+")");var n=React.createElement("span",{className:"bolt-dropdown-filter-bar-item-selected-text"},o);return r.props.showPlaceholderAsLabel?React.createElement(React.Fragment,null,React.createElement("span",{className:"bolt-dropdown-filter-bar-item-placeholder"},r.props.placeholder+": "),n):n},r.wrappedItems=wrapListBoxItems(t.items),r.selection=t.selection||new DropdownSelection,r.selectDefaultFilterItem(),r}return __extends(t,e),t.prototype.focus=function(){this.dropdown.current&&this.dropdown.current.focus()},t.prototype.render=function(){var e=this;return React.createElement(SelectionObserver,{selection:this.selection,onSelectionChanged:this.onSelectionChanged},function(){var t=ObservableLike.getValue(e.props.actions||[]),r=__spreadArrays(t);return e.props.hideClearAction||r.push({className:"bolt-dropdown-action-right-button",disabled:0===e.selection.selectedCount,iconProps:{iconName:"Clear"},text:Resources.DropdownClearActionText,onClick:e.onClearClick}),React.createElement(Observer,{dropdownItems:{observableValue:e.props.items,filter:e.selectDefaultFilterItem}},function(){return React.createElement(Dropdown,__assign({renderExpandable:e.renderExpandableButton,width:DropdownFilterBarItemWidth},e.props,{actions:r,selection:e.selection,ref:e.dropdown}))})})},t}(FilterBarItem);export{DropdownFilterBarItem};