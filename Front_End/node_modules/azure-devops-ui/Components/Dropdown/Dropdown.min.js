function updateFilteredItems(e,t){var r=t.filteredSelection,n=t.filterText,l=[],i=getListBoxItemsValue(t.wrappedItems||e.items),o=i;if(e.userFilteredItems){o=getItemsValue(e.userFilteredItems);var s=e.userFilteredItemsIndexMap&&e.userFilteredItemsIndexMap.value;if(s)l=s;else for(var a=function(e){var t=i.findIndex(function(t){return t.id===o[e].id});l.push(t)},d=0;d<e.userFilteredItems.length;d++)a(d)}if(e.filterByText&&n.value){var p=filterItems(o,n.value,l,e.filterItem);o=p.filteredItems,l=p.filteredIndexMap}for(;o.length&&o[0].type===ListBoxItemType.Divider;)o.shift(),l.shift();if(!ObservableLike.getValue(e.searching)&&!ObservableLike.getValue(e.loading)&&t.expanded.value)if(n.value){var c=Resources.NoFilterResults;e.filteredNoResultsText&&(c=ObservableLike.getValue(e.filteredNoResultsText)),Utils_Accessibility.announce(o.length>0?format(Resources.AnnounceFilterResultCount,o.length):c,!0)}else 0===o.length&&e.noItemsText?Utils_Accessibility.announce(e.noItemsText,!0):o.length>0&&Utils_Accessibility.announce(format(Resources.AnnounceItemCount,o.length));return r.updateFilteredSelection(l,!e.enforceSingleSelect&&void 0),t.filteredItems.value=o,!0}import{__assign,__extends,__spreadArrays}from"tslib";import"../../CommonImports";import"../../Core/core.css";import"./Dropdown.css";import*as React from"react";import{ObservableArray,ObservableLike,ObservableValue}from"../../Core/Observable";import{TimerManagement}from"../../Core/TimerManagement";import*as Utils_Accessibility from"../../Core/Util/Accessibility";import{format}from"../../Core/Util/String";import{FilteredListSelection,renderListCell}from"../../List";import{getListBoxItemsValue,getUnselectableRanges,ListBoxItemType,wrapListBoxItems}from"../../ListBox";import{ItemsObserver,Observer}from"../../Observer";import*as Resources from"../../Resources.Dropdown";import{SimpleTableCell}from"../../Table";import{css}from"../../Util";import{DropdownSelection}from"../../Utilities/DropdownSelection";import{getItemsValue}from"../../Utilities/Provider";import{DropdownCallout}from"./DropdownCallout";import{DropdownExpandableTextField}from"./DropdownExpandableTextField";var Dropdown=function(e){function t(t){var r=e.call(this,t)||this;r.expandable=React.createRef(),r.expandableContainer=React.createRef(),r.filterText=new ObservableValue(""),r.collapse=function(){r.expandable.current&&r.expandable.current.collapse()},r.expand=function(){r.expandable.current&&r.expandable.current.expand()},r.onDismiss=function(){r.expandable.current&&r.expandable.current.collapse()},r.onExpand=function(){r.props.onExpand&&r.props.onExpand(),r.updateFilteredItems(),r.state.expanded.value=!0},r.onCollapse=function(){r.props.onCollapse&&r.props.onCollapse(),r.state.expanded.value=!1},r.onActivate=function(e,t){if(!e.defaultPrevented&&"keydown"===e.type){var n=!r.props.enforceSingleSelect&&r.state.filteredSelection.multiSelect;n?r.state.filteredSelection.toggle(r.state.filteredItems.value.indexOf(t),r.state.filteredSelection.alwaysMerge,n):r.state.filteredSelection.select(r.state.filteredItems.value.indexOf(t),1,r.state.filteredSelection.alwaysMerge,n),r.onSelect(e,t)}},r.onFilterTextChanged=function(e,t){r.filterText.value=t,r.debouncedUpdateFilteredItems()},r.onSelect=function(e,t){var n=r.props,l=n.dismissOnSelect,i=n.onSelect,o=r.parentSelection;i&&i(e,t),(void 0!==l?l:o.value.length>0&&!(!r.props.enforceSingleSelect&&o.multiSelect)&&!o.selectOnFocus)&&r.onDismiss()},r.selectionChanged=function(e,t){return r.state.filteredSelection.selectionChanged(e,t),!0},r.renderCallout=function(e,t,n,l,i,o,s){var a=r.props,d=a.actions,p=a.calloutContentClassName,c=a.columns,m=a.containerClassName,u=a.filterPlaceholderText,f=a.filteredNoResultsText,x=a.getUnselectableRanges,h=a.items,g=a.loading,I=a.noItemsText,b=a.renderItem,v=a.renderBeforeContent,T=a.searching,S=a.showFilterBox,y=a.showItemsWhileSearching,C=a.showTree,w=a.userFilteredItems,F=r.props.width;void 0===F&&r.expandableContainer.current&&(F=Math.max(r.expandableContainer.current.clientWidth,100));var L=r.state,R=L.filteredItems,B=L.filterText,O={actions:d,anchorElement:n,anchorOffset:l,anchorOrigin:i,anchorPoint:o,calloutContentClassName:p,columns:c,containerClassName:m,dropdownOrigin:s,filteredItems:R,filteredNoResultsText:f,selection:L.filteredSelection,filterPlaceholderText:u,filterText:B,getUnselectableRanges:x,id:t,items:h,loading:g,noItemsText:I,onActivate:r.onActivate,onFilterTextChanged:r.onFilterTextChanged,onDismiss:r.onDismiss,onSelect:r.onSelect,renderBeforeContent:v,renderItem:b,searching:T,showItemsWhileSearching:y,showFilterBox:S,showTree:C,updateFilteredItems:r.updateFilteredItems,userFilteredItems:w,width:F};return r.props.renderCallout(O)},r.updateFilteredItems=function(){return updateFilteredItems(r.props,r.state),!0},r.debouncedUpdateFilteredItems=function(){updateFilteredItems(r.props,r.state)},r.parentSelection=t.selection||new DropdownSelection;var n=wrapListBoxItems(t.items),l=getListBoxItemsValue(n||t.items);return r.timerManagement=new TimerManagement,r.state={expanded:new ObservableValue(!1),filteredItems:new ObservableArray(__spreadArrays(l)),filteredSelection:new FilteredListSelection(r.parentSelection),filterText:r.filterText,props:t,wrappedItems:n},r}return __extends(t,e),t.getDerivedStateFromProps=function(e,t){return e.userFilteredItems===t.props.userFilteredItems&&e.items===t.props.items||updateFilteredItems(e,t),__assign(__assign({},t),{props:e,wrappedItems:wrapListBoxItems(e.items)})},t.prototype.componentDidMount=function(){this.props.filterThrottleWait&&(this.debouncedUpdateFilteredItems=this.timerManagement.debounce(this.debouncedUpdateFilteredItems,this.props.filterThrottleWait))},t.prototype.render=function(){var e=this,t=this.props,r=t.ariaLabel,n=t.className,l=t.disabled,i=t.enforceSingleSelect,o=t.excludeTabStop,s=t.items,a=t.placeholder,d=t.renderExpandable,p=t.renderSelectedItems,c={observableValue:this.parentSelection,filter:this.selectionChanged};return React.createElement(ItemsObserver,{getUnselectableRanges:this.props.getUnselectableRanges,items:s,selection:this.parentSelection},React.createElement(Observer,{selection:c},function(){return d({ariaLabel:r,className:css(n,"bolt-dropdown-expandable"),containerRef:e.expandableContainer,disabled:l,enforceSingleSelect:i,excludeTabStop:o,placeholder:a,onCollapse:e.onCollapse,onExpand:e.onExpand,expandableRef:e.expandable,renderCallout:e.renderCallout,items:getListBoxItemsValue(e.state.wrappedItems||s),renderSelectedItems:p,selection:e.parentSelection})}))},t.prototype.focus=function(){this.expandable.current&&this.expandable.current.focus()},t.defaultProps={filterByText:!0,filterItem:filterItemByText,getUnselectableRanges:getUnselectableRanges,renderCallout:DropdownCallout,renderExpandable:DropdownExpandableTextField,renderSelectedItems:renderDropdownSelectedItemText},t}(React.Component);export{Dropdown};export function filterItemByText(e,t){return!(!t.text||t.type===ListBoxItemType.Header||t.type===ListBoxItemType.Divider||t.type===ListBoxItemType.Loading)&&-1!==t.text.toLowerCase().indexOf(e.toLowerCase())};export function renderDropdownSelectedItemText(e,t){var r=t[e.value[0].beginIndex],n=r&&r.text||"";return e.selectedCount>1&&(n=n+" (+"+(e.selectedCount-1)+")"),n};export function filterItems(e,t,r,n){void 0===r&&(r=[]),void 0===n&&(n=filterItemByText);var l=[],i=[],o=[];if(t)for(var s=void 0,a=-1,d=void 0,p=-1,c=0,m=e.length;c<m;c++){var u=e[c],f=r.length?r[c]:c;if(u.type===ListBoxItemType.Header)s=u,a=f;else if(u.type===ListBoxItemType.Divider)d=u,p=f;else{var x=n(t,u,e);(x||u.type===ListBoxItemType.Loading)&&(d&&d.groupId===u.groupId&&(l.push(d),i.push(p),d=void 0),s&&s.groupId===u.groupId&&(l.push(s),i.push(a),s=void 0),l.push(u),i.push(f),o.push(Array.isArray(x)?x:[]))}}return{filteredItems:l,filteredIndexMap:i,filterMatches:o}};export function filterTreeItems(e,t,r,n){void 0===r&&(r=[]),void 0===n&&(n=filterItemByText);for(var l={},i=0,o=filterItems(e,t,r,n).filteredIndexMap;i<o.length;i++){for(var s=e[f=o[i]],a=s.parent;a;){l[e.indexOf(a)]=a,a=a.parent}l[f]=s}for(var d=[],p=[],c=0,m=Object.keys(l);c<m.length;c++){var u=m[c],f=Number(u),x=l[f];d.push(f),p.push(x)}return{filteredIndexMap:d,filteredItems:p,filterMatches:[]}};export function renderHighlightedText(e,t,r,n,l){var i=n;return l&&n.text&&(i=__assign(__assign({},n),{textNode:getHighlightedText(n.text,l)})),React.createElement(SimpleTableCell,{className:css(r.className,n.className,n.type===ListBoxItemType.Header&&"bolt-list-box-header"),columnIndex:t,key:t,tableColumn:r},React.createElement("div",{id:n.type===ListBoxItemType.Header?"header-"+n.id:void 0,"aria-label":n.type===ListBoxItemType.Header?format(Resources.HeaderAriaLabel,n.text):void 0},renderListCell(i)))};export function getHighlightedText(e,t,r){for(var n=[],l=-1,i=0;i<e.length;i++)-1!==t.indexOf(i)?n&&n[n.length-1]&&n[n.length-1].bold?n[l].text+=e.charAt(i):n[++l]={text:e.charAt(i),bold:!0}:n&&n[n.length-1]&&!n[n.length-1].bold?n[l].text+=e.charAt(i):n[++l]={text:e.charAt(i),bold:!1};for(var o=[],i=0;i<n.length;i++){var s=n[i];s.bold?o.push(React.createElement("span",{className:"font-weight-heavy",key:e+"-"+i},s.text)):o.push(s.text)}return React.createElement("span",{className:r},o)};