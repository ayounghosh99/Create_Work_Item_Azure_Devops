import{__assign,__extends}from"tslib";import"../../CommonImports";import"../../Core/core.css";import"./Dialog.css";import*as React from"react";import{EventManagement}from"../../Core/EventManagement";import{announce}from"../../Core/Util/Accessibility";import{ScreenContext,ScreenSize}from"../../Core/Util/Screen";import{format}from"../../Core/Util/String";import{Callout,ContentJustification,ContentLocation,ContentOrientation,ContentSize}from"../../Callout";import{FocusZoneKeyStroke}from"../../FocusZone";import{Icon}from"../../Icon";import{Observer}from"../../Observer";import*as Resources from"../../Resources.Layer";import{Spinner,SpinnerSize}from"../../Spinner";import{Spacing,Surface,SurfaceContext}from"../../Surface";import{css,KeyCode}from"../../Util";var MIN_DIALOG_Size=320,DIALOG_RESIZE_INCREMENT=2,CustomDialog=function(e){function t(t){var n=e.call(this,t)||this;return n.events=new EventManagement,n.contentRef=React.createRef(),n.onGripperKeyDown=function(e){if(n.contentRef.current){var t=n.contentRef.current.getBoundingClientRect();switch(n.currentHeight=t.height,n.currentWidth=t.width,e.keyCode){case KeyCode.leftArrow:n.setState({width:Math.max(n.currentWidth-DIALOG_RESIZE_INCREMENT,MIN_DIALOG_Size)});break;case KeyCode.rightArrow:n.setState({width:n.currentWidth+DIALOG_RESIZE_INCREMENT});break;case KeyCode.upArrow:n.setState({height:Math.max(n.currentHeight-DIALOG_RESIZE_INCREMENT,MIN_DIALOG_Size)});break;case KeyCode.downArrow:n.setState({height:n.currentHeight+DIALOG_RESIZE_INCREMENT});break;default:return}e.preventDefault(),e.stopPropagation(),announce(format(Resources.SizeFormat,n.state.height||n.currentHeight,n.state.width||n.currentWidth))}},n.onGripperMouseDown=function(e){n.onGripperDown(e,e.clientX,e.clientY),n.attachMouseWindowEvents()},n.onGripperDown=function(e,t,o){if(n.contentRef&&(e.preventDefault(),e.stopPropagation(),n.anchorX=t,n.anchorY=o,n.contentRef.current)){var i=n.contentRef.current.getBoundingClientRect();n.currentHeight=i.height,n.currentWidth=i.width}},n.onGripperMouseMove=function(e){n.handleDragEvent(e,e.clientX,e.clientY)},n.onGripperMouseUp=function(e){n.detachMouseWindowEvents(),announce(format(Resources.SizeFormat,n.state.height,n.state.width))},n.state={},n}return __extends(t,e),t.prototype.render=function(){var e=this,t=this.props,n=t.ariaDescribedBy,o=t.ariaLabel,i=t.ariaLabelledBy,r=t.blurDismiss,a=t.calloutClassName,s=t.className,c=t.calloutContentClassName,l=t.contentJustification,u=t.contentLocation,m=t.defaultActiveElement,p=t.escDismiss,h=t.id,d=t.lightDismiss,f=t.onDismiss,g=t.overlay,v=t.modal,C=t.resizable,S=t.role,E=t.contentSize,w=void 0===E?ContentSize.Medium:E;return React.createElement(Observer,{size:this.context.size},function(t){var E=t.size===ScreenSize.xsmall;return React.createElement(Callout,{ariaDescribedBy:n,ariaLabel:o,ariaLabelledBy:i,blurDismiss:r,className:css(a,"bolt-dialog-callout"),contentClassName:css(c,"bolt-dialog-callout-content relative scroll-auto",E&&"bolt-dialog-mobile flex-grow"),contentJustification:l,contentLocation:u,contentOrientation:ContentOrientation.Column,contentRef:e.contentRef,contentShadow:!0,contentSize:E?void 0:w,escDismiss:p,focuszoneProps:{circularNavigation:!0,defaultActiveElement:m||".bolt-dialog-focus-element",focusOnMount:!0,handleTabKey:!0,includeDefaults:!0,postprocessKeyStroke:function(e){return e.which===KeyCode.tab&&e.preventDefault(),FocusZoneKeyStroke.IgnoreParents}},id:h,lightDismiss:d,modal:v,onDismiss:f,role:S,height:e.state.height,width:e.state.width},React.createElement(SurfaceContext.Consumer,null,function(t){return React.createElement(Surface,__assign({},t,{spacing:Spacing.default}),React.createElement("div",{className:css(s,"bolt-dialog-root flex-column flex-grow scroll-hidden")},React.createElement("div",{className:"bolt-dialog-focus-element no-outline",tabIndex:-1}),e.props.children,!E&&C&&React.createElement(Icon,{ariaLabel:Resources.Resize,iconName:"GripperResize",onMouseDown:e.onGripperMouseDown,onKeyDown:e.onGripperKeyDown,tabIndex:0,wrapperClass:"bolt-dialog-resize-icon"}),g&&React.createElement("div",{className:"absolute-fill bolt-dialog-overlay flex-column justify-center"},React.createElement(Spinner,{size:SpinnerSize.large,ariaLabel:g.spinnerAriaLabel,ariaLive:"assertive",label:g.spinnerLabel}))))}))})},t.prototype.handleDragEvent=function(e,t,n){var o=Math.max((this.currentWidth||0)+2*(t-this.anchorX),MIN_DIALOG_Size),i=Math.max((this.currentHeight||0)+2*(n-this.anchorY),MIN_DIALOG_Size);this.setState({width:o,height:i})},t.prototype.attachMouseWindowEvents=function(){this.events.addEventListener(window,"mousemove",this.onGripperMouseMove),this.events.addEventListener(window,"mouseup",this.onGripperMouseUp)},t.prototype.detachMouseWindowEvents=function(){this.events.removeEventListener(window,"mousemove",this.onGripperMouseMove),this.events.removeEventListener(window,"mouseup",this.onGripperMouseUp)},t.defaultProps={contentJustification:ContentJustification.Center,contentLocation:ContentLocation.Center,escDismiss:!0,lightDismiss:!0},t.contextType=ScreenContext,t}(React.Component);export{CustomDialog};