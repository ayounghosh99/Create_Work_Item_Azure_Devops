import{__assign,__extends}from"tslib";import"../../CommonImports";import"../../Core/core.css";import"./Tree.css";import"./TreeExpand.css";import*as React from"react";import{ObservableLike}from"../../Core/Observable";import{FocusWithin}from"../../FocusWithin";import{FocusZone,FocusZoneContext,FocusZoneDirection,FocusZoneKeyStroke}from"../../FocusZone";import{getDefaultAnchorProps}from"../../Link";import{renderListCell}from"../../List";import{Observer}from"../../Observer";import{renderColumns,renderLoadingCell,SimpleTableCell,Table}from"../../Table";import{css,KeyCode,preventDefault}from"../../Util";import{getTabIndex}from"../../Utilities/Focus";import{TreeExpand}from"./TreeExpand";var Tree=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.table=React.createRef(),t.onActivateExpand=function(e,r){!e.defaultPrevented&&r.data.underlyingItem.childItems&&(t.props.onToggle&&t.props.onToggle(e,r.data),e.preventDefault())},t.renderRow=function(e,r,o){return o.singleClickActivation=t.props.onActivate&&o.singleClickActivation,React.createElement(Observer,{data:r.underlyingItem.data},function(n){if(n.data){r.onToggle=r.underlyingItem.childItems?t.props.onToggle:void 0;var l=r.underlyingItem.data.renderRow||t.props.renderRow;return l?l(e,r,o):renderTreeRow(e,r,o,t.props.columns,n.data)}var a=t.props.renderLoadingRow;return a?a(e,o):React.createElement(TreeRow,{index:e,details:o},t.props.columns.map(function(e,t){var r=renderLoadingCell(e.columnLayout);return e.hierarchical&&(r=React.createElement(TreeExpand,{depth:o.data.depth},r)),SimpleTableCell({className:"bolt-tree-cell",columnIndex:t,children:r})}))})},t}return __extends(t,e),t.prototype.render=function(){var e=this.props.role,t=void 0===e?"treegrid":e,r=this.props.onActivate?this.props.onActivate:this.props.onToggle?this.onActivateExpand:void 0;return React.createElement(Table,{ariaLabel:this.props.ariaLabel,behaviors:this.props.behaviors,className:this.props.className,columns:this.props.columns,containerClassName:this.props.containerClassName,eventDispatch:this.props.eventDispatch,focuszoneProps:this.props.focuszoneProps,id:this.props.id,itemProvider:this.props.itemProvider,maxHeight:this.props.maxHeight,onActivate:r,onFocus:this.props.onFocus,onSelect:this.props.onSelect,pageSize:this.props.pageSize,renderHeader:this.props.renderHeader,renderRow:this.renderRow,renderSpacer:this.props.renderSpacer,role:t,rowHeight:this.props.rowHeight,ref:this.table,scrollable:this.props.scrollable,selectableText:this.props.selectableText,selection:this.props.selection,singleClickActivation:this.props.singleClickActivation,showHeader:this.props.showHeader,showLines:this.props.showLines,tableBreakpoints:this.props.tableBreakpoints,virtualize:this.props.virtualize})},t.prototype.addOverlay=function(e,t,r,o){if(void 0===o&&(o=0),this.table.current)return this.table.current.addOverlay(e,t,r,o)},t.prototype.removeOverlay=function(e){if(this.table.current)return this.table.current.removeOverlay(e)},t.prototype.focusRow=function(e,t){return void 0===t&&(t=1),this.table.current?this.table.current.focusRow(e,t):Promise.resolve()},t.prototype.getFocusIndex=function(){return this.table.current?this.table.current.getFocusIndex():-1},t.prototype.getStats=function(){return this.table.current?this.table.current.getStats():{firstMaterialized:-1,firstRendered:-1,lastMaterialized:-1,lastRendered:-1}},t.prototype.scrollIntoView=function(e,t){if(this.table.current)return this.table.current.scrollIntoView(e,t)},t}(React.Component);export{Tree};var TreeRow=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.rowElement=React.createRef(),t.onFocus=function(e){t.props.details.onFocusItem(t.props.index,e)},t.onKeyDown=function(e){if(!e.defaultPrevented&&t.rowElement.current===e.nativeEvent.srcElement){var r=t.props.details.data;if(r&&r.onToggle){var o=r.underlyingItem.expanded;(e.which===KeyCode.rightArrow&&!o||e.which===KeyCode.leftArrow&&o)&&(r.onToggle(e,r),e.preventDefault())}}},t.onPostprocessKeyStroke=function(e){return e.defaultPrevented||e.which===KeyCode.leftArrow&&(t.rowElement.current.focus(),e.preventDefault()),FocusZoneKeyStroke.IgnoreNone},t}return __extends(t,e),t.prototype.render=function(){var e=this,t=this.props,r=t.details,o=t.index,n=t.linkProps,l=r.ariaRowOffset,a=r.data,s=r.excludeFocusZone,i=r.renderSpacer,c=r.selectableText,p=r.selection,d=r.singleClickActivation,u=n?"a":"tr",m=getDefaultAnchorProps(n);return React.createElement(FocusWithin,{onFocus:this.onFocus},function(t){return React.createElement(FocusZoneContext.Consumer,null,function(h){return React.createElement(FocusZone,{direction:FocusZoneDirection.Horizontal,postprocessKeyStroke:e.onPostprocessKeyStroke},React.createElement(u,__assign({},m,{"aria-busy":void 0===a,"aria-expanded":a&&a.underlyingItem.expanded,"aria-level":a?a.depth+1:void 0,"aria-rowindex":o+l,"aria-selected":!(!p||!p.selected(o))||void 0,className:css(e.props.className,"bolt-tree-row bolt-table-row bolt-list-row",0===o&&"first-row",t.hasFocus&&"focused",p&&p.selected(o)&&"selected",d&&"single-click-activation",c&&"selectable-text",n&&"v-align-middle"),"data-focuszone":s||p&&!p.selectable(o)?void 0:h.focuszoneId,"data-row-index":o,tabIndex:getTabIndex(r),onBlur:t.onBlur,onFocus:t.onFocus,onKeyDown:e.onKeyDown,ref:e.rowElement,role:"row"}),React.createElement("td",{key:"left-spacer",className:"bolt-table-cell-compact bolt-table-cell bolt-list-cell",role:"presentation"},i&&i(o,!0)),e.props.children,React.createElement("td",{key:"right-spacer",className:"bolt-table-cell-compact bolt-table-cell bolt-list-cell",role:"presentation"},i&&i(o,!1))))})})},t}(React.Component);export{TreeRow};export function renderTreeRow(e,t,r,o,n,l){return React.createElement(TreeRow,{index:e,details:r,linkProps:n?n.linkProps:void 0,className:l},renderColumns(e,o,t,r))};export function ExpandableTreeCell(e){var t=e.colspan,r=e.columnIndex,o=e.contentClassName,n=e.treeItem,l=e.treeColumn,a=n.depth,s=n.onToggle,i=n.underlyingItem.expanded,c=React.createElement(TreeExpand,{expanded:i,depth:a,indentationSize:l&&l.indentationSize,onClick:preventDefault,onToggle:s?function(e){return s(e,n)}:void 0},e.children);return SimpleTableCell({children:c,className:css(e.className,"bolt-tree-cell"),colspan:t,columnIndex:r,contentClassName:o,tableColumn:l})};export function renderExpandableTreeCell(e,t,r,o){var n=o.underlyingItem,l=ObservableLike.getValue(n.data),a=l&&l[r.id],s=!(!a||"string"==typeof a||"number"==typeof a||!a.href);return ExpandableTreeCell({children:a&&renderListCell(a),className:r.className,columnIndex:t,contentClassName:s?"bolt-table-cell-content-with-link":void 0,treeItem:o,treeColumn:r})};export function renderTreeCell(e,t,r,o){var n=o.underlyingItem,l=ObservableLike.getValue(n.data),a=l&&l[r.id],s=!(!a||"string"==typeof a||"number"==typeof a||!a.href);return SimpleTableCell({className:r.className,children:a&&renderListCell(a),columnIndex:t,contentClassName:s?"bolt-table-cell-content-with-link":void 0,tableColumn:r})};export function renderTreeCellWithClassName(e,t,r,o,n){var l=o.underlyingItem,a=ObservableLike.getValue(l.data),s=a&&a[r.id],i=!(!s||"string"==typeof s||"number"==typeof s||!s.href);return SimpleTableCell({className:r.className,children:s&&renderListCell(s),columnIndex:t,contentClassName:css(n,i?"bolt-table-cell-content-with-link":void 0),tableColumn:r})};