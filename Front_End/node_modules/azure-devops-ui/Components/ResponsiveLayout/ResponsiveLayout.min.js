import{__assign,__extends}from"tslib";import"../../CommonImports";import"../../Core/core.css";import*as React from"react";import{shimRef}from"../../Util";import{ResponsiveOrientation}from"./ResponsiveLayout.Props";var ResponsiveLayout=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.childDetails=[],t.childKeys=[],t.containerRef=React.createRef(),t.hiddenCount=0,t.layoutTimeout=0,t.updateLayout=function(){var e=t.containerRef.current;if(e&&e.children.length){var i=t.hiddenCount,n=e.getBoundingClientRect(),o=0,r=0,l=!1;t.childDetails&&e.children.length===t.childDetails.length||(t.childDetails=[],l=!0);for(var s=0;s<e.children.length;s++){var a=e.children[s].getBoundingClientRect();l?t.childDetails.push({appliedSize:0,clientRect:a}):t.childDetails[s].clientRect=a,t.props.ignoredChildren&&t.props.ignoredChildren.indexOf(s)>=0&&(r+=t.props.orientation===ResponsiveOrientation.Vertical?a.height:a.width)}o=t.props.orientation===ResponsiveOrientation.Vertical?Math.floor(t.childDetails[t.childDetails.length-1].clientRect.bottom-t.childDetails[0].clientRect.top):Math.floor(t.childDetails[t.childDetails.length-1].clientRect.right-t.childDetails[0].clientRect.left),o-=Math.floor(r);var h=Math.floor(t.props.orientation===ResponsiveOrientation.Vertical?n.height:n.width);if(h<=o)for(u=h-o;u<0&&t.hiddenCount<t.props.responsiveChildren.length;){var d=t.props.responsiveChildren[t.hiddenCount],c=t.childDetails[d],p=t.props.orientation===ResponsiveOrientation.Vertical?c.clientRect.height:c.clientRect.width;u+=p,c.hidden=!0,c.appliedSize=p,t.hiddenCount++}else if(h>o)for(var u=h-o;t.hiddenCount>0;){var d=t.props.responsiveChildren[t.hiddenCount-1],c=t.childDetails[d];if(t.childDetails[d].appliedSize+8>=u)break;u-=c.appliedSize,c.hidden=!1,t.hiddenCount--}i!=t.hiddenCount&&(t.layoutTimeout=window.setTimeout(function(){t.layoutTimeout=0,t.props.onLayoutChange&&t.props.onLayoutChange(t.hiddenCount),t.forceUpdate()},0))}},t}return __extends(t,e),t.prototype.render=function(){var e=this,t=[],i=React.Children.only(this.props.children);this.containerRef=shimRef(i);var n=React.cloneElement(i,__assign(__assign({},i.props),{ref:this.containerRef}),React.Children.map(i.props.children,function(i,n){return i.key||(console.warn("All children MUST have a unique key"),i.key=n),t[n]=i.key,e.childDetails&&e.childDetails[n]&&e.childDetails[n].hidden?React.createElement("div",{key:"PH"+n,className:"responsive-placeholder"}):i}));if(this.childKeys)if(this.childKeys.length!==t.length)this.resetLayout();else for(var o=0;o<t.length;o++)if(this.childKeys[o]!==t[o]){this.resetLayout();break}return this.childKeys=t,n},t.prototype.componentDidMount=function(){window.addEventListener("resize",this.updateLayout),this.updateLayout()},t.prototype.componentDidUpdate=function(){this.updateLayout()},t.prototype.componentWillUnmount=function(){this.layoutTimeout&&(window.clearTimeout(this.layoutTimeout),this.layoutTimeout=0),window.removeEventListener("resize",this.updateLayout)},t.prototype.resetLayout=function(){this.childDetails=void 0,this.hiddenCount=0},t}(React.Component);export{ResponsiveLayout};