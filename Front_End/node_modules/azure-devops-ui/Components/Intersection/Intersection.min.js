import{__assign,__extends}from"tslib";import"../../CommonImports";import"../../Core/core.css";import*as React from"react";import{shimRef}from"../../Util";for(var defaultThreshold=[],index=0;index<=100;index++)defaultThreshold.push(index/100);var IntersectionContextImpl=function(){function t(){var t=this;this.callbacks=[],this.pending=[],this.rootMargin=0,this.root=document.body,this.onIntersect=function(e){if(t.observer)for(var o=0,n=t.callbacks;o<n.length;o++){(0,n[o])(e,t.observer)}}}return t.prototype.connect=function(t,e,o){void 0===e&&(e=0),void 0===o&&(o=defaultThreshold),this.observer=new IntersectionObserver(this.onIntersect,{root:t,rootMargin:e+"px",threshold:o}),this.rootMargin=e,this.root=t;for(var n=0,r=this.pending;n<r.length;n++){var s=r[n];this.observer.observe(s)}},t.prototype.disconnect=function(){this.observer&&this.observer.disconnect()},t.prototype.observe=function(t){this.observer?this.observer.observe(t):this.pending.push(t)},t.prototype.register=function(t){this.callbacks.push(t)},t.prototype.unobserve=function(t){var e=this.pending.indexOf(t);e>=0&&this.pending.splice(e,1),this.observer&&this.observer.unobserve(t)},t.prototype.unregister=function(t){var e=this.callbacks.indexOf(t);e>=0&&this.callbacks.splice(e,1)},t}();export var IntersectionContext=React.createContext(new IntersectionContextImpl);var Intersection=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.state=new IntersectionContextImpl,e.onScroll=function(t){e.state.onIntersect([])},e}return __extends(e,t),e.prototype.render=function(){var t=this,e=React.Children.only(this.props.children);this.props.rootElement||(this.rootElement=shimRef(e));var o;return o=e.props.onScroll?function(o){e.props.onScroll&&e.props.onScroll(o),t.onScroll(o)}:this.onScroll,React.createElement(IntersectionContext.Provider,{value:this.state},React.cloneElement(e,__assign(__assign({},e.props),{ref:this.rootElement,onScroll:o}),e.props.children))},e.prototype.componentDidMount=function(){var t=this.props,e=t.observationElement,o=t.rootElement,n=null;if(o?(n="string"==typeof o?document.querySelector(o):"function"==typeof o?o():o)&&(n.addEventListener("scroll",this.onScroll),this.externalElement=n):this.rootElement&&(n=this.rootElement.current),n&&(this.state.connect(n,this.props.rootMargin,this.props.threshold),this.props.onIntersect&&this.state.register(this.props.onIntersect),e)){var r=void 0;(r="string"==typeof e?document.querySelector(e):"function"==typeof e?e():e)&&this.state.observe(r)}},e.prototype.componentWillUnmount=function(){this.externalElement&&this.externalElement.removeEventListener("scroll",this.onScroll),this.state.disconnect()},e}(React.Component);export{Intersection};