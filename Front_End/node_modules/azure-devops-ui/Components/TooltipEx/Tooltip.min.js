function overflowDetected(t){return t.scrollWidth>Math.ceil(t.offsetWidth)}import{__assign,__extends}from"tslib";import"../../CommonImports";import"../../Core/core.css";import"./Tooltip.css";import*as React from"react";import{Callout}from"../../Callout";import{FocusWithin}from"../../FocusWithin";import{MouseWithin}from"../../MouseWithin";import{css,getFocusVisible,getSafeId,KeyCode,Mouse}from"../../Util";import{Location}from"../../Utilities/Position";export var TooltipStatus;!function(t){t[t.hidden=0]="hidden",t[t.visible=1]="visible",t[t.fadingout=2]="fadingout"}(TooltipStatus||(TooltipStatus={}));var tooltipId=1,Tooltip=function(t){function o(o){var e=t.call(this,o)||this;return e.contentRef=React.createRef(),e.tooltipId="tooltip-"+tooltipId++,e.focus=!1,e.mouse=!1,e.showTooltip=function(t){var o=t.currentTarget;if(e.shouldShowTooltip(o)){var n=void 0;e.props.anchorOrigin||(n=Mouse.position),e.mouse=!0,document.addEventListener("keydown",e.onKeyDown),e.setState({anchorElement:o,anchorOffset:{horizontal:8,vertical:8},anchorOrigin:{horizontal:Location.center,vertical:Location.end},anchorPoint:n,innerText:e.props.overflowOnly&&!e.props.text?o.innerText:void 0,tooltipStatus:TooltipStatus.visible,tooltipOrigin:{horizontal:Location.start,vertical:Location.start}})}},e.closeTooltip=function(){e.focus&&getFocusVisible()||e.state.tooltipStatus!==TooltipStatus.visible||(e.mouse=!1,document.removeEventListener("keydown",e.onKeyDown),e.setState({tooltipStatus:e.getDismissStatus()}))},e.onKeyDown=function(t){var o;if(t.which===KeyCode.escape&&e.state.tooltipStatus===TooltipStatus.visible&&e.closeTooltip(),t.which===KeyCode.ctrl&&e.state.tooltipStatus===TooltipStatus.visible){var n=e.contentRef.current,i=null===(o=window.getSelection())||void 0===o?void 0:o.anchorNode;n&&i&&n.contains(i)||e.closeTooltip()}},e.onAnimationEnd=function(){e.state.tooltipStatus===TooltipStatus.fadingout&&e.setState({tooltipStatus:TooltipStatus.hidden})},e.getDismissStatus=function(){return e.props.disabled?TooltipStatus.hidden:TooltipStatus.fadingout},e.shouldShowTooltip=function(t){return e.state.tooltipStatus===TooltipStatus.hidden&&(!(e.props.overflowOnly&&!e.overflowDetected(t))&&(!!(e.props.text||e.props.renderContent||t.innerText&&e.props.overflowOnly)&&!e.props.disabled))},e.overflowDetected=o.overflowDetected||overflowDetected,e.state={tooltipStatus:TooltipStatus.hidden},e}return __extends(o,t),o.prototype.render=function(){var t=this;return React.createElement(MouseWithin,{leaveDelay:50,enterDelay:this.props.delayMs,onMouseLeave:this.closeTooltip,onMouseEnter:this.showTooltip},function(o){var e,n,i=React.Children.only(t.props.children),s=t.props.id||t.tooltipId,r=t.state.tooltipStatus!==TooltipStatus.hidden&&!t.props.disabled&&t.state.anchorElement,a=i.props.onMouseEnter,l=i.props.onMouseLeave,p=i.props.onKeyDown,c=t.props.addAriaDescribedBy&&t.state.tooltipStatus!==TooltipStatus.hidden?getSafeId(s):void 0,u=__assign(__assign({},i.props),{onMouseEnter:function(t){o.onMouseEnter&&o.onMouseEnter(t),a&&a(t)},onMouseLeave:function(t){o.onMouseLeave&&o.onMouseLeave(t),l&&l(t)},onKeyDown:function(o){o.which===KeyCode.escape&&r&&(t.setState({tooltipStatus:TooltipStatus.hidden}),o.preventDefault()),p&&p(o)}});void 0===u["aria-describedby"]&&(u["aria-describedby"]=c);var d=React.cloneElement(i,u,i.props.children);if(t.props.showOnFocus&&(t.props.text||t.props.renderContent||t.props.overflowOnly)){e=i.props.onBlur,n=i.props.onFocus;var h=function(){t.focus=!1,t.mouse||t.closeTooltip(),e&&e()},f=function(o){var e=o.currentTarget;t.shouldShowTooltip(e)&&(t.focus=!0,getFocusVisible()&&t.setState({anchorElement:o.target,anchorOffset:{horizontal:0,vertical:8},anchorOrigin:{horizontal:Location.center,vertical:Location.end},anchorPoint:void 0,innerText:t.props.overflowOnly&&!t.props.text?e.innerText:void 0,tooltipStatus:TooltipStatus.visible,tooltipOrigin:{horizontal:Location.center,vertical:Location.start}})),n&&n(o)};d=React.createElement(FocusWithin,{onBlur:h,onFocus:f,updateStateOnFocusChange:!1},d)}return React.createElement(React.Fragment,null,d,r?React.createElement(Callout,{anchorElement:t.state.anchorElement,anchorOffset:t.props.anchorOffset||t.state.anchorOffset,anchorOrigin:t.props.anchorOrigin||t.state.anchorOrigin,anchorPoint:t.state.anchorPoint,calloutOrigin:t.props.tooltipOrigin||t.state.tooltipOrigin,className:css(t.props.className,"bolt-tooltip",t.state.tooltipStatus===TooltipStatus.fadingout&&"bolt-tooltip-fade-out"),fixedLayout:t.props.fixedLayout,id:s,key:s,onAnimationEnd:t.onAnimationEnd,onMouseEnter:o.onMouseEnter,onMouseLeave:o.onMouseLeave,portalProps:{className:"bolt-tooltip-portal"},contentRef:t.contentRef,role:"tooltip"},React.createElement("div",{className:"bolt-tooltip-content body-m"},t.props.renderContent&&t.props.renderContent()||t.props.text||t.state.innerText)):null)})},o.prototype.componentWillUnmount=function(){document.removeEventListener("keydown",this.onKeyDown)},o.defaultProps={delayMs:250,showOnFocus:!0},o}(React.Component);export{Tooltip};