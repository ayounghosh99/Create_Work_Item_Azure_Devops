import{__assign,__extends}from"tslib";import"../../CommonImports";import"../../Core/core.css";import"./TextField.css";import*as React from"react";import{FocusWithin}from"../../FocusWithin";import{FocusZoneContext}from"../../FocusZone";import{FormItemContext}from"../../FormItem";import{Icon,IconSize}from"../../Icon";import{Observer}from"../../Observer";import{Tooltip}from"../../TooltipEx";import{css,getSafeId}from"../../Util";import{getTabIndex}from"../../Utilities/Focus";import{TextFieldFocusTreatmentBehavior,TextFieldStyle,TextFieldWidth}from"./TextField.Props";var inputId=1,TextField=function(e){function t(t){var n=e.call(this,t)||this;return n.select=function(){n.inputElement.current&&n.inputElement.current.select()},n.inputId="textfield-input-"+inputId++,n.inputElement=t.inputElement||React.createRef(),n}return __extends(t,e),t.prototype.focus=function(){this.inputElement.current&&this.inputElement.current.focus()},Object.defineProperty(t.prototype,"selectionEnd",{get:function(){return this.inputElement.current?this.inputElement.current.selectionEnd:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selectionStart",{get:function(){return this.inputElement.current?this.inputElement.current.selectionStart:null},enumerable:!0,configurable:!0}),t.prototype.setSelectionRange=function(e,t,n){this.inputElement.current&&this.inputElement.current.setSelectionRange(e,t,n)},t.prototype.render=function(){var e=this,t=this.props,n=(t.autoAdjustHeight,t.className),o=t.containerClassName,i=t.disabled,r=t.focusTreatment,a=void 0===r?TextFieldFocusTreatmentBehavior.all:r,l=t.inputId,s=t.label,u=t.onBlur,c=t.onFocus,d=t.style,p=t.value,m=t.width,f=React.createElement(FocusWithin,{onFocus:c,onBlur:u},function(t){return React.createElement(FormItemContext.Consumer,null,function(r){return React.createElement("div",{className:css("flex-column",o,m!==TextFieldWidth.auto&&m)},React.createElement("div",{className:css(!s&&n,"bolt-textfield flex-row flex-center",i&&"disabled",a===TextFieldFocusTreatmentBehavior.all&&"focus-treatment",a===TextFieldFocusTreatmentBehavior.keyboardOnly&&"focus-keyboard-only",t.hasFocus&&"focused",d===TextFieldStyle.inline&&"bolt-textfield-inline",r.error&&"bolt-textfield-error")},React.createElement(FocusZoneContext.Consumer,null,function(n){return React.createElement(Observer,{value:p},function(o){return React.createElement(TextFieldInnerValue,__assign({},e.props,{focus:function(){return e.focus()},focusStatus:t,formItemContext:r,inputElement:e.inputElement,inputId:e.props.inputId||e.inputId,value:o.value,zoneContext:n}))})})))})});return s?React.createElement("div",{className:css(n,"flex-column")},React.createElement("label",{htmlFor:getSafeId(l||this.inputId),className:"bolt-textfield-label"},s),f):f},t}(React.Component);export{TextField};var TextFieldInnerValue=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.adjustedHeight=-1,t.adjustedHeightValue="",t.hiddenElement=React.createRef(),t}return __extends(t,e),t.prototype.render=function(){var e=this,t=this.props,n=t.activatable,o=t.ariaActiveDescendant,i=t.ariaAutoComplete,r=t.ariaControls,a=t.ariaExpanded,l=t.ariaHasPopup,s=t.ariaInvalid,u=t.ariaLabel,c=t.ariaLabelledBy,d=t.ariaRoleDescription,p=t.autoAdjustHeight,m=t.autoComplete,f=t.autoFocus,h=t.autoSelect,x=t.disabled,b=t.excludeFocusZone,g=t.focus,v=t.focusStatus,I=t.formItemContext,F=t.inputClassName,y=t.inputElement,E=t.inputId,C=t.inputType,R=t.maxLength,T=t.maxWidth,_=t.multiline,S=t.onClick,j=t.onKeyDown,H=t.onKeyPress,N=t.onKeyUp,k=t.onPaste,B=t.placeholder,w=t.prefixIconProps,z=t.readOnly,P=t.required,D=t.resizable,O=t.role,W=t.rows,K=t.spellCheck,A=t.tooltipProps,L=t.value,U=t.zoneContext,V=this.props,Z=V.ariaDescribedBy,q=V.suffixIconProps,M=_?"textarea":"input",G=_?{rows:W}:{type:C,autoComplete:m?"on":"off"};void 0===q&&I.error&&(q={className:"bolt-textfield-message-error",iconName:"Error"}),void 0===Z&&(Z=I.ariaDescribedById);var J=css(F,"bolt-textfield-input flex-grow",p&&"bolt-textfield-auto-adjust",D&&"bolt-textfield-auto-unresizable",w&&"bolt-textfield-input-with-prefix",q&&"bolt-textfield-input-with-suffix",n&&"activatable"),Q=void 0!==T?{maxWidth:T}:{},X=React.createElement(M,__assign({},G,{"aria-activedescendant":getSafeId(o),"aria-autocomplete":i,"aria-controls":getSafeId(r),"aria-describedby":getSafeId(Z),"aria-disabled":x,"aria-expanded":a,"aria-haspopup":l,"aria-invalid":s,"aria-label":void 0===u&&B?B:u,"aria-labelledby":getSafeId(c)||getSafeId(I.ariaLabelledById),"aria-readonly":C&&"text"!==C?z:void 0,"aria-required":P,"aria-roledescription":d,autoFocus:f,"data-focuszone":x||b?void 0:U.focuszoneId,disabled:x,className:J,id:getSafeId(E),maxLength:R,onBlur:v.onBlur,onClick:S,onChange:function(t){e.props.onChange&&e.props.onChange(t,t.target.value),e.adjustHeight()},onFocus:function(e){h&&y.current&&y.current.select(),v.onFocus&&v.onFocus(e)},onKeyDown:j,onKeyPress:H,onKeyUp:N,onPaste:k,placeholder:B,readOnly:z,required:P,ref:y,role:O,style:Q,spellCheck:K,tabIndex:getTabIndex(this.props),value:L||""}));return _&&p&&(X=React.createElement("div",{className:"flex-row flex-grow relative"},React.createElement(M,{"aria-hidden":!0,className:css("bolt-textfield-auto-adjust-hidden",J),ref:this.hiddenElement,role:"presentation"}),X)),React.createElement(React.Fragment,null,w&&Icon(__assign(__assign({size:IconSize.medium},w),{className:css(w.className,"prefix",!w.render&&"bolt-textfield-icon",(B&&!L||w.render)&&"bolt-textfield-no-text"),onClick:function(e){w&&w.onClick&&w.onClick(e),g()}})),A?React.createElement(Tooltip,__assign({},A),X):X,q&&Icon(__assign(__assign({size:IconSize.medium},q),{className:css(q.className,"suffix",!q.render&&"bolt-textfield-icon",(B&&!L||q.render)&&"bolt-textfield-no-text"),onClick:function(e){q&&q.onClick&&q.onClick(e),g()}})))},t.prototype.componentDidMount=function(){this.adjustHeight()},t.prototype.componentDidUpdate=function(){this.adjustHeight()},t.prototype.adjustHeight=function(){var e=this.hiddenElement,t=this.props,n=t.autoAdjustHeight,o=t.inputElement,i=t.multiline,r=t.value;i&&n&&o.current&&e.current&&r!==this.adjustedHeightValue&&(e.current.value=o.current.value,this.adjustedHeight!==e.current.scrollHeight&&(this.adjustedHeight=e.current.scrollHeight,this.adjustedHeightValue=o.current.value,o.current.style.height=this.adjustedHeight+"px"))},t}(React.Component);