import"../../CommonImports";import"../../Core/core.css";import"./List.css";import"./ListDropIndicator.css";import*as React from"react";import{getPointByEventType}from"../../Util";import{DragDropEffect}from"../../Utilities/DragDrop";import{cellFromEvent}from"./List";import{ListDropIndicator}from"./ListDropIndicator";import{ListDropIndicatorPosition}from"./ListDropIndicator.Props";var ListDropTargetBehavior=function(){function t(t){var o=this;this.initialize=function(t,r,e){o.dragDroppableUI=r,o.eventDispatch=e,o.eventDispatch.addEventListener("dragenter",o.onDragEnter),o.eventDispatch.addEventListener("dragexit",o.onDragExit),o.eventDispatch.addEventListener("dragover",o.onDragOver),o.eventDispatch.addEventListener("drop",o.onDrop),o.itemProvider=t.itemProvider,o.indicatorName=o.options.isTree?"tree-drop-indicator":"drop-indicator"},this.onDragEnter=function(t){o.handlesType(t)&&(o.options.onDragEnter?o.options.onDragEnter(t):t.detail.dataTransfer.dropEffect=DragDropEffect.move)},this.onDragExit=function(t){o.handlesType(t)&&(o.options.onDragExit&&o.options.onDragExit(t),o.dragDroppableUI.removeOverlay(o.indicatorName))},this.onDragOver=function(t){if(o.handlesType(t)){var r=o.calculateIndex(t),e=t.detail.dataTransfer.secondaryData.index,i=t.detail.dataTransfer.secondaryData.sourceId;r>=0&&(r!==e||i!==o.options.id||o.options.isTree)?o.options.onDragOver?o.options.onDragOver(t,{index:o.listIndicatorPosition===ListDropIndicatorPosition.bottom?r+1:r}):t.detail.dataTransfer.dropEffect=DragDropEffect.move:t.detail.dataTransfer.dropEffect=DragDropEffect.none,t.detail.dataTransfer.dropEffect===DragDropEffect.none?o.dragDroppableUI.removeOverlay(o.indicatorName):o.dragDroppableUI.addOverlay(o.indicatorName,r,o.renderDropIndicator)}},this.onDrop=function(t){if(o.handlesType(t)){var r=o.calculateIndex(t),e=t.detail.dataTransfer.secondaryData.index,i=t.detail.dataTransfer.secondaryData.sourceId;r>=0&&(r!==e||i!==o.options.id)&&o.options.onDrop&&o.options.onDrop(t,{index:o.listIndicatorPosition===ListDropIndicatorPosition.bottom?r+1:r}),o.dragDroppableUI.removeOverlay(o.indicatorName)}},this.renderDropIndicator=function(t){return o.options.isTree?React.createElement("div",{className:"bolt-list-tree-drop-target flex-grow"}):React.createElement(ListDropIndicator,{position:o.listIndicatorPosition})},this.options=t}return t.prototype.componentDidUpdate=function(t){this.itemProvider=t.itemProvider},t.prototype.componentWillUnmount=function(){var t,o,r;null===(t=this.eventDispatch)||void 0===t||t.removeEventListener("dragenter",this.onDragEnter),null===(o=this.eventDispatch)||void 0===o||o.removeEventListener("dragexit",this.onDragExit),null===(r=this.eventDispatch)||void 0===r||r.removeEventListener("dragover",this.onDragOver)},t.prototype.calculateIndex=function(t){var o=cellFromEvent(t),r=o.rowIndex;if(this.options.isTree)return r;if(o.rowElement&&t.detail.dataTransfer.secondaryData){var e=t.detail.dataTransfer.secondaryData.index,i=t.detail.dataTransfer.secondaryData.sourceId,n=t.detail.nativeEvent,a=o.rowElement.getBoundingClientRect(),s=getPointByEventType(n),d=s?s.y<a.height/2+a.top:r<e;this.options.id!==i?(this.listIndicatorPosition=ListDropIndicatorPosition.top,d||r++,r>=this.itemProvider.length&&(this.listIndicatorPosition=ListDropIndicatorPosition.bottom,r--)):r<e?(this.listIndicatorPosition=ListDropIndicatorPosition.top,d||r++):r>e&&(this.listIndicatorPosition=ListDropIndicatorPosition.bottom,d&&r--)}return r},t.prototype.handlesType=function(t){var o,r=(null===(o=t.detail.dataTransfer)||void 0===o?void 0:o.type)||"";return-1!==this.options.allowedTypes.indexOf(r)},t}();export{ListDropTargetBehavior};