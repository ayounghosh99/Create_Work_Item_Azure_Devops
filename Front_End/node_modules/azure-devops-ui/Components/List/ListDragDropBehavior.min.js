import"../../CommonImports";import"../../Core/core.css";import"./List.css";import"./ListDropIndicator.css";import{KeyCode,noop}from"../../Util";import{dispatchCustomDragEvent,DragDropEffect}from"../../Utilities/DragDrop";import{cellFromEvent}from"./List";import{ListDragSourceBehavior}from"./ListDragSourceBehavior";import{ListDropTargetBehavior}from"./ListDropTargetBehavior";var ListDragDropBehavior=function(){function e(e){var t=this;this.initialize=function(e,o,r){t.eventDispatch=r,t.itemProvider=e.itemProvider,t.eventDispatch.addEventListener("keydown",t.onKeyDown),t.dragBehavior.initialize(e,o,r),t.dropBehavior.initialize(e,o,r)},this.onDragRowKeyDown=function(e){e.which===KeyCode.escape?t.endDrag(e):e.which===KeyCode.space?t.endDrag(e,!0):e.which===KeyCode.downArrow?(t.focusIndex=Math.min(t.focusIndex+1,t.itemProvider.length),t.fireRowDragEvents(e)):e.which===KeyCode.upArrow&&(t.focusIndex=Math.max(t.focusIndex-1,0),t.fireRowDragEvents(e)),e.preventDefault()},this.onKeyDown=function(e){if(!e.defaultPrevented&&e.which===KeyCode.space&&"INPUT"!==e.target.tagName){var o=cellFromEvent(e).rowIndex;t.focusIndex=o;var r=t.itemProvider.value[o];t.dataTransfer={data:r,dropEffect:DragDropEffect.none,secondaryData:{index:o,sourceId:t.options.id},setDragImage:noop,type:t.options.type},dispatchCustomDragEvent("dragstart",e.target,e.nativeEvent,t.dataTransfer),t.dataTransfer.effectAllowed!==DragDropEffect.none&&(t.dragItemRowElement=e.target,t.dragItemRowElement.addEventListener("keydown",t.onDragRowKeyDown))}},this.options=e,this.dragBehavior=new ListDragSourceBehavior(e),this.dropBehavior=new ListDropTargetBehavior(e)}return e.prototype.componentDidUpdate=function(e){this.itemProvider=e.itemProvider,this.dragBehavior.componentDidUpdate(e),this.dropBehavior.componentDidUpdate(e)},e.prototype.componentWillUnmount=function(){var e;null===(e=this.eventDispatch)||void 0===e||e.removeEventListener("keydown",this.onKeyDown),this.dragItemRowElement&&this.dragItemRowElement.removeEventListener("keydown",this.onDragRowKeyDown),this.dragBehavior.componentWillUnmount(),this.dropBehavior.componentWillUnmount()},e.prototype.dispatchEventAtIndex=function(e,t,o,r){for(var i=t;i&&!i.classList.contains("bolt-list");)i=i.parentElement;if(i){var n=i.querySelector("[data-row-index='"+r+"']");n&&dispatchCustomDragEvent(e,n,o,this.dataTransfer)}},e.prototype.endDrag=function(e,t){void 0===t&&(t=!1),dispatchCustomDragEvent("dragend",e.target,e,this.dataTransfer),t?this.dispatchEventAtIndex("drop",e.target,e,this.focusIndex):this.dispatchEventAtIndex("dragexit",e.target,e,this.focusIndex),this.dragItemRowElement&&(this.dragItemRowElement.removeEventListener("keydown",this.onDragRowKeyDown),this.dragItemRowElement=void 0)},e.prototype.fireRowDragEvents=function(e){this.dispatchEventAtIndex("dragenter",e.target,e,this.focusIndex),this.dispatchEventAtIndex("dragover",e.target,e,this.focusIndex)},e}();export{ListDragDropBehavior};