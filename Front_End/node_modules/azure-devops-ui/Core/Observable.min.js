import{__extends,__spreadArrays}from"tslib";import*as React from"react";var Observable=function(){function e(){this.observers={},this.subscriberCount=0}return e.prototype.notify=function(e,t,r){var s=function(e,t,r){try{e(t,r)}catch(e){console.warn(e),e&&"function"==typeof ErrorEvent&&window.dispatchEvent(new ErrorEvent("error",{error:e,filename:"Observable.ts",message:e.message}))}};if(this.observers[t])for(var n=this.observers[t].slice(),i=0;i<n.length;i++)s(n[i],e,t);if(this.observers[""])for(var n=this.observers[""].slice(),i=0;i<n.length;i++)s(n[i],e,t);r&&(this.events||(this.events=[]),this.events.push({action:t,value:e}))},e.prototype.subscribe=function(e,t){if(t=t||"",this.observers[t]||(this.observers[t]=[]),this.observers[t].push(e),this.subscriberCount++,this.events)for(var r=0,s=this.events;r<s.length;r++){var n=s[r];t&&n.action!==t||e(n.value,n.action)}return e},e.prototype.unsubscribe=function(e,t){if(t=t||"",this.observers[t]){var r=this.observers[t].indexOf(e);r>=0&&(this.observers[t].splice(r,1),this.subscriberCount--)}},e}();export{Observable};export var ObservableLike;!function(e){function t(e){return e&&"function"==typeof e.subscribe}e.isObservable=t,e.getValue=function(e){return t(e)?e.value:e},e.subscribe=function(e,r,s){return t(e)?e.subscribe(r,s):function(){}},e.unsubscribe=function(e,r,s){t(e)&&e.unsubscribe(r,s)}}(ObservableLike||(ObservableLike={}));var ObservableValue=function(e){function t(t){var r=e.call(this)||this;return r.v=t,r}return __extends(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.v},set:function(e){this.v=e,this.notify(this.v,"set")},enumerable:!0,configurable:!0}),t}(Observable);export{ObservableValue};var ObservableObject=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.objects={},t}return __extends(t,e),t.prototype.add=function(e,t){this.objects.hasOwnProperty(e)||(this.objects[e]=t,this.notify({key:e,value:t},"add"))},t.prototype.get=function(e){return this.objects[e]},t.prototype.set=function(e,t){this.objects.hasOwnProperty(e)?(this.objects[e]=t,this.notify({key:e,value:t},"replace")):this.add(e,t)},t.prototype.keys=function(){return Object.keys(this.objects)},t}(Observable);export{ObservableObject};var ObservableArray=function(e){function t(t){void 0===t&&(t=[]);var r=e.call(this)||this;return r.internalItems=t||[],r}return __extends(t,e),t.prototype.change=function(e){for(var t,r=[],s=1;s<arguments.length;s++)r[s-1]=arguments[s];return(t=this.internalItems).splice.apply(t,__spreadArrays([e,r.length],r)),this.notify({index:e,changedItems:r},"change"),r.length},Object.defineProperty(t.prototype,"length",{get:function(){return this.internalItems.length},enumerable:!0,configurable:!0}),t.prototype.push=function(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];if(t.length){var s=this.internalItems.length;(e=this.internalItems).push.apply(e,t),this.notify({addedItems:t,index:s},"push")}return t.length},t.prototype.pop=function(){var e=this.internalItems.pop();return void 0!==e&&this.notify({index:this.internalItems.length,removedItems:[e]},"pop"),e},t.prototype.removeAll=function(e){for(var t=[],r=[],s=0,n=this.internalItems;s<n.length;s++){a=n[s];!e||e(a)?t.push(a):r.push(a)}if(t.length>0){this.internalItems.splice(0,this.internalItems.length);for(var i=0,o=r;i<o.length;i++){var a=o[i];this.internalItems.push(a)}this.notify({index:0,removedItems:t},"removeAll")}return t},t.prototype.splice=function(e,t){for(var r,s=[],n=2;n<arguments.length;n++)s[n-2]=arguments[n];var i=(r=this.internalItems).splice.apply(r,__spreadArrays([e,t],s));return this.notify({addedItems:s,index:e,removedItems:i},"splice"),i},Object.defineProperty(t.prototype,"value",{get:function(){return this.internalItems},set:function(e){var t;if(e===this.internalItems)t=this.internalItems;else if(t=this.internalItems.slice(),this.internalItems.length=0,e.length)for(var r=0,s=e;r<s.length;r++){var n=s[r];this.internalItems.push(n)}this.notify({addedItems:e,index:0,removedItems:t},"splice")},enumerable:!0,configurable:!0}),t}(Observable);export{ObservableArray};var ObservableCollection=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.collections=[],t.items=[],t}return __extends(t,e),Object.defineProperty(t.prototype,"length",{get:function(){return this.subscriberCount||this.recalculateItems(),this.items.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this.subscriberCount||this.recalculateItems(),this.items},enumerable:!0,configurable:!0}),t.prototype.push=function(e,t){var r,s;if(ObservableLike.isObservable(e)){var n=e,i=this.getSubscriber(this.collections.length,t);r={observable:n,subscriber:i,transformItems:t,items:[]},s=n.value,this.subscriberCount&&ObservableLike.subscribe(r.observable,i)}else e.length&&(s=e,r={items:this.transformItems(s,t)});if(r&&(this.collections.push(r),this.subscriberCount&&s.length)){for(var o=this.transformItems(s,t),a=0,u=o;a<u.length;a++){var l=u[a];this.items.push(l)}this.notify({addedItems:o,index:this.items.length-o.length},"push")}},t.prototype.subscribe=function(t,r){var s=e.prototype.subscribe.call(this,t,r);if(1===this.subscriberCount){this.recalculateItems();for(var n=0,i=this.collections;n<i.length;n++){var o=i[n];o.subscriber&&o.observable.subscribe(o.subscriber)}}return s},t.prototype.unsubscribe=function(t,r){if(e.prototype.unsubscribe.call(this,t,r),0===this.subscriberCount)for(var s=0,n=this.collections;s<n.length;s++){var i=n[s];i.subscriber&&i.observable.unsubscribe(i.subscriber)}},t.prototype.recalculateItems=function(){this.items.length=0;for(var e=0,t=this.collections;e<t.length;e++){var r=t[e];r.observable&&(r.items=this.transformItems(r.observable.value,r.transformItems));for(var s=0,n=r.items;s<n.length;s++){var i=n[s];this.items.push(i)}}},t.prototype.transformItems=function(e,t){var r;if(e)if(t){r=[];for(var s=0,n=e;s<n.length;s++){var i=t(n[s]);void 0!==i&&r.push(i)}}else r=e;else r=[];return r},t.prototype.getSubscriber=function(e,t){var r=this;return function(s){for(var n,i=s.index,o=0;o<e;o++)i+=r.collections[o].items.length;if(s.changedItems){var a=r.transformItems(s.changedItems,t);(n=r.items).splice.apply(n,__spreadArrays([i,s.changedItems.length],a)),r.notify({changedItems:a,index:i},"change")}else{var u=r.transformItems(s.removedItems,t),l=r.transformItems(s.addedItems,t);r.items.splice(i,u.length);for(var c=r.items.splice(i),b=0,h=l;b<h.length;b++){p=h[b];r.items.push(p)}for(var v=0,f=c;v<f.length;v++){var p=f[v];r.items.push(p)}r.notify({removedItems:u,addedItems:l,index:i},"splice")}}},t}(Observable);export{ObservableCollection};var ReadyableObservableArray=function(e){function t(t,r){void 0===t&&(t=[]),void 0===r&&(r=!1);var s=e.call(this,t)||this;return s.ready=new ObservableValue(r),s}return __extends(t,e),t}(ObservableArray);export{ReadyableObservableArray};export function useObservable(e){var t=React.useState(e)[0],r=React.useState(function(){return new ObservableValue(t)})[0];return[r,function(e){r.value="function"==typeof e?e(r.value):e}]};export function useObservableArray(e){var t=React.useState(e)[0],r=React.useState(new ObservableArray(t));return[r[0],function(e){r[0].value="function"==typeof e?e(r[0].value):e}]};export function useDerivedObservable(e,t,r){var s=useObservable(t(e.value)),n=s[0],i=s[1],o=React.useCallback(t,r);return useSubscription(e,function(e){var t=o(e);i(t)},r),n};export function useSubscription(e,t,r){void 0===r&&(r=[]);var s=React.useCallback(t,r);React.useEffect(function(){return e.subscribe(s),function(){return e.unsubscribe(s)}},[e,s])};export function useDebouncedSubscription(e,t,r,s){void 0===s&&(s=[]);var n=React.useRef(null);useSubscription(e,function(e){n.current&&clearTimeout(n.current),n.current=setTimeout(function(){r(e),n.current=null},t)},__spreadArrays([t],s))};